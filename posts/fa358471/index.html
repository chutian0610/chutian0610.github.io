<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.victorchu.info","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"style":null,"show_result":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"waline","storage":false,"lazyload":false,"nav":null,"activeClass":"waline"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"X9UOD4FSUP","apiKey":"fa32db1f02073025c69da8ebad0a6aa6","indexName":"hexo-next-blog","hits":{"per_page":10}}}</script><script src="/js/config.js"></script><meta name="description" content="反射常被用于在程序运行时检查或修改其执行行为。 为什么要使用反射 反射可以在下面几点帮助我们  扩展功能  扩展已有类的功能，例如有些字段不支持访问或修改，可以使用反射扩展。   类浏览器和可视化开发  类浏览器需要枚举类的成员，广泛应用于可视化开发环境   调试和测试工具  调试器需要能够检查类的私有成员，测试工具会使用反射调用API。    反射的弊端 反射很强大，但是不要滥用，如果可以避免使"><meta property="og:type" content="article"><meta property="og:title" content="Java 反射"><meta property="og:url" content="https://www.victorchu.info/posts/fa358471/index.html"><meta property="og:site_name" content="代码之旅"><meta property="og:description" content="反射常被用于在程序运行时检查或修改其执行行为。 为什么要使用反射 反射可以在下面几点帮助我们  扩展功能  扩展已有类的功能，例如有些字段不支持访问或修改，可以使用反射扩展。   类浏览器和可视化开发  类浏览器需要枚举类的成员，广泛应用于可视化开发环境   调试和测试工具  调试器需要能够检查类的私有成员，测试工具会使用反射调用API。    反射的弊端 反射很强大，但是不要滥用，如果可以避免使"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2017-05-24T04:19:49.000Z"><meta property="article:modified_time" content="2024-06-27T06:53:33.474Z"><meta property="article:author" content="Victor Chu"><meta property="article:tag" content="Reflect"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.victorchu.info/posts/fa358471/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.victorchu.info/posts/fa358471/","path":"/posts/fa358471/","title":"Java 反射"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Java 反射 | 代码之旅</title><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?277fc29fa80de77c97f4f62b69e94233"></script><link rel="dns-prefetch" href="walineui.victorchu.info"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="代码之旅" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">代码之旅</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">I love Coding !</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">109</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">80</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">199</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="algolia-stats"><hr></div><div class="algolia-hits"></div><div class="algolia-pagination"></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84"><span class="nav-number">1.</span> <span class="nav-text">为什么要使用反射</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E7%9A%84%E5%BC%8A%E7%AB%AF"><span class="nav-number">2.</span> <span class="nav-text">反射的弊端</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E4%B8%8E%E7%B1%BB"><span class="nav-number">3.</span> <span class="nav-text">反射与类</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.1.</span> <span class="nav-text">如何获取类实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-getClass"><span class="nav-number">3.1.1.</span> <span class="nav-text">Object.getClass()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class-%E8%AF%AD%E6%B3%95"><span class="nav-number">3.1.2.</span> <span class="nav-text">.class 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-forName"><span class="nav-number">3.1.3.</span> <span class="nav-text">Class.forName()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E7%9A%84Class-forName"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">数组类型的Class.forName()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%80%BC%E7%B1%BB%E5%9E%8B%E9%80%9A%E8%BF%87%E5%8C%85%E8%A3%85%E7%B1%BB%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.1.4.</span> <span class="nav-text">基本值类型通过包装类获取类实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class%E7%9A%84%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">Class的其它方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-getSuperclass"><span class="nav-number">3.2.1.</span> <span class="nav-text">Class.getSuperclass()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-getClasses"><span class="nav-number">3.2.2.</span> <span class="nav-text">Class.getClasses()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-getDeclaredClasses"><span class="nav-number">3.2.3.</span> <span class="nav-text">Class.getDeclaredClasses()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getDeclaringClass"><span class="nav-number">3.2.4.</span> <span class="nav-text">getDeclaringClass()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-getEnclosingClass"><span class="nav-number">3.2.5.</span> <span class="nav-text">Class.getEnclosingClass()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E7%9A%84%E6%A0%87%E8%AF%86%E7%AC%A6%E5%92%8C%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="nav-number">3.3.</span> <span class="nav-text">类的标识符和类型检查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E4%BF%AE%E9%A5%B0%E7%AC%A6%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">3.3.1.</span> <span class="nav-text">获取修饰符的例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A2%E7%B4%A2%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98"><span class="nav-number">3.4.</span> <span class="nav-text">探索类的成员</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#field"><span class="nav-number">3.4.1.</span> <span class="nav-text">field</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#method"><span class="nav-number">3.4.2.</span> <span class="nav-text">method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#constructor"><span class="nav-number">3.4.3.</span> <span class="nav-text">constructor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98%E7%9A%84%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.4.4.</span> <span class="nav-text">获取类的成员的代码示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E4%B8%AD%E7%9A%84%E7%B1%BB%E6%88%90%E5%91%98%E2%80%93Field"><span class="nav-number">4.</span> <span class="nav-text">反射中的类成员–Field</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Field%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.1.</span> <span class="nav-text">获取Field的类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Field%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.2.</span> <span class="nav-text">获取Field的修饰符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Field-getModifiers"><span class="nav-number">4.2.1.</span> <span class="nav-text">Field.getModifiers()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field-isSynthetic"><span class="nav-number">4.3.</span> <span class="nav-text">Field.isSynthetic()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E7%B1%BBthis-0"><span class="nav-number">4.3.1.</span> <span class="nav-text">内部类this$0</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Field%E5%80%BC%E7%9A%84get%E5%92%8Cset"><span class="nav-number">4.4.</span> <span class="nav-text">Field值的get和set</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84Exception"><span class="nav-number">4.5.</span> <span class="nav-text">需要注意的Exception</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E8%BD%AC%E5%9E%8B%E5%BC%82%E5%B8%B8-IllegalArgumentException"><span class="nav-number">4.5.1.</span> <span class="nav-text">不可转型异常 IllegalArgumentException</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%9D%83%E9%99%90%E4%BF%AE%E6%94%B9%E5%BC%82%E5%B8%B8"><span class="nav-number">4.5.2.</span> <span class="nav-text">无权限修改异常</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E4%B8%AD%E7%9A%84%E7%B1%BB%E6%88%90%E5%91%98%E2%80%93Method"><span class="nav-number">5.</span> <span class="nav-text">反射中的类成员–Method</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E6%B3%95%E5%A3%B0%E6%98%8E%E4%BF%A1%E6%81%AF"><span class="nav-number">5.1.</span> <span class="nav-text">获取方法声明信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">获取方法参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Parameter%E7%B1%BB%E4%B8%AD%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">5.3.</span> <span class="nav-text">Parameter类中的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E5%92%8C%E5%90%88%E6%88%90%E5%8F%82%E6%95%B0"><span class="nav-number">5.4.</span> <span class="nav-text">隐式和合成参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">5.5.</span> <span class="nav-text">分析方法修饰符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">5.6.</span> <span class="nav-text">调用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Exception"><span class="nav-number">5.7.</span> <span class="nav-text">Exception</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%B1%E4%BA%8E%E7%B1%BB%E5%9E%8B%E6%93%A6%E9%99%A4%E5%BC%95%E8%B5%B7%E7%9A%84%E5%BC%82%E5%B8%B8-NoSuchMethodException%E3%80%82"><span class="nav-number">5.7.1.</span> <span class="nav-text">由于类型擦除引起的异常,NoSuchMethodException。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E6%B3%95%E8%AE%BF%E9%97%AE%E4%BA%A7%E7%94%9F%E7%9A%84IllegalAccessException"><span class="nav-number">5.7.2.</span> <span class="nav-text">非法访问产生的IllegalAccessException</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IllegalArgumentException"><span class="nav-number">5.7.3.</span> <span class="nav-text">IllegalArgumentException</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InvocationTargetException"><span class="nav-number">5.7.4.</span> <span class="nav-text">InvocationTargetException</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E4%B8%AD%E7%9A%84%E7%B1%BB%E6%88%90%E5%91%98%E2%80%93Constructor"><span class="nav-number">6.</span> <span class="nav-text">反射中的类成员–Constructor</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">6.1.</span> <span class="nav-text">查找构造函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">6.2.</span> <span class="nav-text">分析构造函数修饰符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%B1%BB%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.</span> <span class="nav-text">创建新的类实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Array"><span class="nav-number">7.</span> <span class="nav-text">Array</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">7.1.</span> <span class="nav-text">数组的操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#enum"><span class="nav-number">8.</span> <span class="nav-text">enum</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Victor Chu" src="/images/victor-blog-head.webp"><p class="site-author-name" itemprop="name">Victor Chu</p><div class="site-description" itemprop="description">blog about programming.</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">199</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">80</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">109</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/chutian0610" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chutian0610" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:victorchu0610@outlook.com" title="E-Mail → mailto:victorchu0610@outlook.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/victorchu" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;victorchu" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a> </span><span class="links-of-author-item"><a href="/images/Wechat.webp" title="WeChat → &#x2F;images&#x2F;Wechat.webp" rel="noopener me"><i class="fa-brands fa-weixin fa-fw"></i>WeChat</a></span></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.tpfuture.top/" title="https:&#x2F;&#x2F;www.tpfuture.top&#x2F;" rel="noopener" target="_blank">一水轩</a></li></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.victorchu.info/posts/fa358471/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/victor-blog-head.webp"><meta itemprop="name" content="Victor Chu"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="代码之旅"><meta itemprop="description" content="blog about programming."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Java 反射 | 代码之旅"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Java 反射</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2017-05-24 12:19:49" itemprop="dateCreated datePublished" datetime="2017-05-24T12:19:49+08:00">2017-05-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-06-27 14:53:33" itemprop="dateModified" datetime="2024-06-27T14:53:33+08:00">2024-06-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/Basic/" itemprop="url" rel="index"><span itemprop="name">Basic</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Waline：</span> <a title="waline" href="/posts/fa358471/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/fa358471/" itemprop="commentCount"></span> </a></span><span class="post-meta-item" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="waline-pageview-count" data-path="/posts/fa358471/"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>52k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1:27</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>反射常被用于在程序运行时检查或修改其执行行为。</p><h1 id="为什么要使用反射">为什么要使用反射</h1><p>反射可以在下面几点帮助我们</p><ul><li>扩展功能<ul><li>扩展已有类的功能，例如有些字段不支持访问或修改，可以使用反射扩展。</li></ul></li><li>类浏览器和可视化开发<ul><li>类浏览器需要枚举类的成员，广泛应用于可视化开发环境</li></ul></li><li>调试和测试工具<ul><li>调试器需要能够检查类的私有成员，测试工具会使用反射调用API。</li></ul></li></ul><h1 id="反射的弊端">反射的弊端</h1><p>反射很强大，但是不要滥用，如果可以避免使用，尽量避免。当使用反射时，下面的问题需要注意。</p><ul><li>性能开销<ul><li>反射会动态地处理对象，导致JVM的优化不能进行，因此，要避免在性能敏感地地方使用反射。</li></ul></li><li>安全限制<ul><li>反射可能会与安全管理相互冲突。</li></ul></li><li>内部资源暴露<ul><li>反射可以访问private方法，这可能会带来意料之外的副作用。</li></ul></li></ul><span id="more"></span><h1 id="反射与类">反射与类</h1><blockquote><p>java中的对象不是基本值类型就是引用类型，而所有的引用类型都继承自<code>java.lang.Object</code>。</p></blockquote><p>Java虚拟机为每个类生成一个不可变的<code>java.lang.Class</code>的类实例，该类实例提供了对象属性的运行期检查，包括了对象的成员和类型信息。<code>java.lang.Class</code>是所有反射操作的入口。</p><h2 id="如何获取类实例">如何获取类实例</h2><p><code>java.lang.Class</code>是所有反射操作的入口。需要调用<code>java.lang.Class</code>的对应方法，以获取类实例。</p><h3 id="Object-getClass"><code>Object.getClass()</code></h3><p>如果可以获取到一个对象的实例，最简单的获取类实例的方法是调用该对象的<code>getClass()</code>方法。注意，这只是用于引用类型(<code>getClass()</code>方法继承自<code>Object</code>)。下面是几个例子:</p><ul><li>获取<code>String</code>的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&quot;foo&quot;</span>.getClass();</span><br></pre></td></tr></table></figure><ul><li>获取<code>Enum</code>的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">E</span>&#123;A,B&#125;</span><br><span class="line">Class c= A.getClass();</span><br></pre></td></tr></table></figure><ul><li>获取集合的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; s = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> s.getClass();</span><br></pre></td></tr></table></figure><ul><li>获取数组的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> bytes.getClass();</span><br></pre></td></tr></table></figure><h3 id="class-语法"><code>.class</code> 语法</h3><p>如果我们可以获得类型但是无法获取对应的对象，那么可以使用<code>.class</code>语法来获得类实例。这同时解决了基本值类型的类实例获取方法。</p><ul><li>获取基本值类型的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> b;</span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> <span class="type">boolean</span>.class;  <span class="comment">// correct</span></span><br></pre></td></tr></table></figure><ul><li>获取引用类型的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> java.io.PrintStream.class;</span><br></pre></td></tr></table></figure><ul><li>获取数组类型的类实例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> <span class="type">int</span>[][][].class;</span><br></pre></td></tr></table></figure><h3 id="Class-forName"><code>Class.forName()</code></h3><p>如果可以获得一个类的fully-qualified name(包名+类名)，那么可以通过static方法<code>Class.forName()</code>来获得对应的类实例。注意，基本值类型不能使用这个方法。</p><ul><li>String</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="数组类型的Class-forName">数组类型的<code>Class.forName()</code></h4><ul><li>double一维数组</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cDoubleArray</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;[D&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>对应<code>double[].class.getName()</code></p></blockquote><ul><li>String 二维数组</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cStringArray</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;[[Ljava.lang.String;&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>对应<code>String[][].class.getName()</code></p></blockquote><h3 id="基本值类型通过包装类获取类实例">基本值类型通过包装类获取类实例</h3><p>每个基本值类型和void都有自己对应的包装类(java.lang包中)，因此可以通过包装类的<code>TYPE</code>属性来获取对应的封装类的类实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Double.TYPE;</span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Void.TYPE;</span><br></pre></td></tr></table></figure><h2 id="Class的其它方法"><code>Class</code>的其它方法</h2><h3 id="Class-getSuperclass"><code>Class.getSuperclass()</code></h3><p>返回当前类实例的父类。</p><h3 id="Class-getClasses"><code>Class.getClasses()</code></h3><p>返回<code>Class&lt;?&gt;[]</code>，包含了当前类实例的所有public成员类，接口，枚举(包括继承的成员)的类实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt;[] c = Character.class.getDeclaredClasses();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 数组c中会包含Character类中的3个public成员类</span></span><br><span class="line"><span class="comment">* static class    Character.Subset</span></span><br><span class="line"><span class="comment">* static class    Character.UnicodeBlock</span></span><br><span class="line"><span class="comment">* static class    Character.UnicodeScript</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="Class-getDeclaredClasses"><code>Class.getDeclaredClasses()</code></h3><p>返回<code>Class&lt;?&gt;[]</code>，包含了当前类实例的所有(public, protected, friendlly, private )成员类，接口，枚举(包括继承的成员)的类实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt;[] c = Character.class.getDeclaredClasses();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 数组c中会包含Character类中的3个public成员类和一个私有类</span></span><br><span class="line"><span class="comment">* Character.Subset</span></span><br><span class="line"><span class="comment">* Character.UnicodeBlock</span></span><br><span class="line"><span class="comment">* Character.UnicodeScript</span></span><br><span class="line"><span class="comment">* (private)Character.CharacterCache.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="getDeclaringClass"><code>getDeclaringClass()</code></h3><ul><li><code>java.lang.Class.getDeclaringClass()</code></li><li><code>java.lang.reflect.Field.getDeclaringClass()</code></li><li><code>java.lang.reflect.Method.getDeclaringClass()</code></li><li><code>java.lang.reflect.Constructor.getDeclaringClass()</code></li></ul><p>获取Class，Field，Method，Constructor声明所在类，注意，匿名内部类没有声明所在类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> System.class.getField(<span class="string">&quot;out&quot;</span>);</span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> f.getDeclaringClass();</span><br><span class="line"><span class="comment">//  c -&gt; System.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span> &#123;&#125; </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Class</span> <span class="variable">o</span> <span class="operator">=</span> o1.getClass().getEnclosingClass();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  o -&gt; null.</span></span><br></pre></td></tr></table></figure><h3 id="Class-getEnclosingClass"><code>Class.getEnclosingClass()</code></h3><p>返回匿名内部类的封装类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>() &#123; </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span> &#123;&#125; </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Class</span> <span class="variable">o</span> <span class="operator">=</span> o1.getClass().getEnclosingClass();</span><br><span class="line">    <span class="comment">// o -&gt; MyClass</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="类的标识符和类型检查">类的标识符和类型检查</h2><p>一个类有一个或多个修饰符，这些修饰符会影响运行期行为。</p><ul><li>访问权限修饰符<ul><li>public</li><li>protected</li><li>friendly(默认包权限，也被称作default)</li><li>private</li></ul></li><li>重载修饰符<ul><li>abstract</li></ul></li><li>静态修饰符<ul><li>static</li></ul></li><li>不可修改修饰符<ul><li>final</li></ul></li><li>强制严格浮点操作修饰符<ul><li>strictfp</li></ul></li><li>注解</li></ul><p><code>java.lang.reflect.Modifer</code>包含了所有可能的修饰符的声明，也包含了解析<code>Class.getModifiers()</code>返回值的方法。</p><h3 id="获取修饰符的例子">获取修饰符的例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.TypeVariable;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 引用自 </span></span><br><span class="line"><span class="comment"> * http://docs.oracle.com/javase/tutorial/reflect/class/classModifiers.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassDeclarator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            out.format(<span class="string">&quot;Class:%n  %s%n%n&quot;</span>, c.getCanonicalName());</span><br><span class="line">            out.format(<span class="string">&quot;Modifiers:%n  %s%n%n&quot;</span>,Modifier.toString(c.getModifiers()));</span><br><span class="line">            out.format(<span class="string">&quot;Type Parameters:%n&quot;</span>);</span><br><span class="line">            TypeVariable[] tv = c.getTypeParameters();</span><br><span class="line">            <span class="keyword">if</span> (tv.length != <span class="number">0</span>) &#123;</span><br><span class="line">                out.format(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (TypeVariable t : tv)</span><br><span class="line">                    out.format(<span class="string">&quot;%s &quot;</span>, t.getName());</span><br><span class="line">                out.format(<span class="string">&quot;%n%n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.format(<span class="string">&quot;  -- No Type Parameters --%n%n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            out.format(<span class="string">&quot;Implemented Interfaces:%n&quot;</span>);</span><br><span class="line">            Type[] intfs = c.getGenericInterfaces();</span><br><span class="line">            <span class="keyword">if</span> (intfs.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Type intf : intfs)</span><br><span class="line">                    out.format(<span class="string">&quot;  %s%n&quot;</span>, intf.toString());</span><br><span class="line">                out.format(<span class="string">&quot;%n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.format(<span class="string">&quot;  -- No Implemented Interfaces --%n%n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            out.format(<span class="string">&quot;Inheritance Path:%n&quot;</span>);</span><br><span class="line">            List&lt;Class&gt; l = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Class&gt;();</span><br><span class="line">            printAncestor(c, l);</span><br><span class="line">            <span class="keyword">if</span> (l.size() != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Class&lt;?&gt; cl : l)</span><br><span class="line">                    out.format(<span class="string">&quot;  %s%n&quot;</span>, cl.getCanonicalName());</span><br><span class="line">                out.format(<span class="string">&quot;%n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.format(<span class="string">&quot;  -- No Super Classes --%n%n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            out.format(<span class="string">&quot;Annotations:%n&quot;</span>);</span><br><span class="line">            Annotation[] ann = c.getAnnotations();</span><br><span class="line">            <span class="keyword">if</span> (ann.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Annotation a : ann)</span><br><span class="line">                    out.format(<span class="string">&quot;  %s%n&quot;</span>, a.toString());</span><br><span class="line">                out.format(<span class="string">&quot;%n&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.format(<span class="string">&quot;  -- No Annotations --%n%n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printAncestor</span><span class="params">(Class&lt;?&gt; c, List&lt;Class&gt; l)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; ancestor = c.getSuperclass();</span><br><span class="line">        <span class="keyword">if</span> (ancestor != <span class="literal">null</span>) &#123;</span><br><span class="line">            l.add(ancestor);</span><br><span class="line">            printAncestor(ancestor, l);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="探索类的成员">探索类的成员</h2><p><code>java.lang.Class</code>中获取fields,methods和constructors的方法分为两种，一种是获取全部成员，将结果放入List；一种是获取名称对应的成员。<br>另外，根据成员的声明位置，获取成员的方法也分为两种，一种是直接获取类中所有声明的成员，一种是获取类的public成员(包括继承的成员)。</p><p>JAVA 使用 <code>java.lang.reflect.Member</code>接口代表反射使用的类成员。Member成员包含以下几种:</p><ul><li><code>java.lang.reflect.Field</code></li><li><code>java.lang.reflect.Method</code></li><li><code>java.lang.reflect.Constructor</code></li></ul><h3 id="field"><code>field</code></h3><table><thead><tr><th style="text-align:left">Class API</th><th style="text-align:left">List of members ?</th><th style="text-align:left">Inherited members ?</th><th style="text-align:left">Private members ?</th></tr></thead><tbody><tr><td style="text-align:left"><code>getDeclaredField()</code></td><td style="text-align:left">no</td><td style="text-align:left">no</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getField()</code></td><td style="text-align:left">no</td><td style="text-align:left">yes</td><td style="text-align:left">no</td></tr><tr><td style="text-align:left"><code>getDeclaredFields()</code></td><td style="text-align:left">yes</td><td style="text-align:left">no</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getFields()</code></td><td style="text-align:left">yes</td><td style="text-align:left">yes</td><td style="text-align:left">no</td></tr></tbody></table><h3 id="method"><code>method</code></h3><table><thead><tr><th style="text-align:left">Class API</th><th style="text-align:left">List of members ?</th><th style="text-align:left">Inherited members ?</th><th style="text-align:left">Private members ?</th></tr></thead><tbody><tr><td style="text-align:left"><code>getDeclaredMethod()</code></td><td style="text-align:left">no</td><td style="text-align:left">no</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getMethod()</code></td><td style="text-align:left">no</td><td style="text-align:left">yes</td><td style="text-align:left">no</td></tr><tr><td style="text-align:left"><code>getDeclaredMethods()</code></td><td style="text-align:left">yes</td><td style="text-align:left">no</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getMethods()</code></td><td style="text-align:left">yes</td><td style="text-align:left">yes</td><td style="text-align:left">no</td></tr></tbody></table><h3 id="constructor"><code>constructor</code></h3><table><thead><tr><th style="text-align:left">Class API</th><th style="text-align:left">List of members ?</th><th style="text-align:left">Private members ?</th></tr></thead><tbody><tr><td style="text-align:left"><code>getDeclaredConstructor()</code></td><td style="text-align:left">no</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getConstructor()</code></td><td style="text-align:left">no</td><td style="text-align:left">no</td></tr><tr><td style="text-align:left"><code>getDeclaredContructors()</code></td><td style="text-align:left">yes</td><td style="text-align:left">yes</td></tr><tr><td style="text-align:left"><code>getContructors()</code></td><td style="text-align:left">yes</td><td style="text-align:left">no</td></tr></tbody></table><h3 id="获取类的成员的代码示例">获取类的成员的代码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Member;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 引用自</span></span><br><span class="line"><span class="comment"> * http://docs.oracle.com/javase/tutorial/reflect/class/classMembers.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ClassMember</span> &#123; CONSTRUCTOR, FIELD, METHOD, CLASS, ALL &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassSpy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">        out.format(<span class="string">&quot;Class:%n  %s%n%n&quot;</span>, c.getCanonicalName());</span><br><span class="line"></span><br><span class="line">        <span class="type">Package</span> <span class="variable">p</span> <span class="operator">=</span> c.getPackage();</span><br><span class="line">        out.format(<span class="string">&quot;Package:%n  %s%n%n&quot;</span>,</span><br><span class="line">               (p != <span class="literal">null</span> ? p.getName() : <span class="string">&quot;-- No Package --&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (ClassMember.valueOf(args[i])) &#123;</span><br><span class="line">        <span class="keyword">case</span> CONSTRUCTOR:</span><br><span class="line">            printMembers(c.getConstructors(), <span class="string">&quot;Constructor&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> FIELD:</span><br><span class="line">            printMembers(c.getFields(), <span class="string">&quot;Fields&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> METHOD:</span><br><span class="line">            printMembers(c.getMethods(), <span class="string">&quot;Methods&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> CLASS:</span><br><span class="line">            printClasses(c);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ALL:</span><br><span class="line">            printMembers(c.getConstructors(), <span class="string">&quot;Constuctors&quot;</span>);</span><br><span class="line">            printMembers(c.getFields(), <span class="string">&quot;Fields&quot;</span>);</span><br><span class="line">            printMembers(c.getMethods(), <span class="string">&quot;Methods&quot;</span>);</span><br><span class="line">            printClasses(c);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">assert</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printMembers</span><span class="params">(Member[] mbrs, String s)</span> &#123;</span><br><span class="line">    out.format(<span class="string">&quot;%s:%n&quot;</span>, s);</span><br><span class="line">    <span class="keyword">for</span> (Member mbr : mbrs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mbr <span class="keyword">instanceof</span> Field)</span><br><span class="line">        out.format(<span class="string">&quot;  %s%n&quot;</span>, ((Field)mbr).toGenericString());</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mbr <span class="keyword">instanceof</span> Constructor)</span><br><span class="line">        out.format(<span class="string">&quot;  %s%n&quot;</span>, ((Constructor)mbr).toGenericString());</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mbr <span class="keyword">instanceof</span> Method)</span><br><span class="line">        out.format(<span class="string">&quot;  %s%n&quot;</span>, ((Method)mbr).toGenericString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mbrs.length == <span class="number">0</span>)</span><br><span class="line">        out.format(<span class="string">&quot;  -- No %s --%n&quot;</span>, s);</span><br><span class="line">    out.format(<span class="string">&quot;%n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printClasses</span><span class="params">(Class&lt;?&gt; c)</span> &#123;</span><br><span class="line">    out.format(<span class="string">&quot;Classes:%n&quot;</span>);</span><br><span class="line">    Class&lt;?&gt;[] clss = c.getClasses();</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; cls : clss)</span><br><span class="line">        out.format(<span class="string">&quot;  %s%n&quot;</span>, cls.getCanonicalName());</span><br><span class="line">    <span class="keyword">if</span> (clss.length == <span class="number">0</span>)</span><br><span class="line">        out.format(<span class="string">&quot;  -- No member interfaces, classes, or enums --%n&quot;</span>);</span><br><span class="line">    out.format(<span class="string">&quot;%n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="反射中的类成员–Field">反射中的类成员–Field</h1><p><code>java.lang.reflect.Filed</code> 提供了对特定对象Field的操作，包括获取类型信息，get和set值。</p><h2 id="获取Field的类型">获取Field的类型</h2><ul><li><code>Field.getType()</code></li></ul><p>返回field声明类型的类实例。</p><ul><li><code>Field.getGenericType()</code></li></ul><p>返回field对应的泛型类型。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 引用自</span></span><br><span class="line"><span class="comment"> * http://docs.oracle.com/javase/tutorial/reflect/member/fieldTypes.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldSpy</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span>[][] b = &#123;&#123; <span class="literal">false</span>, <span class="literal">false</span> &#125;, &#123; <span class="literal">true</span>, <span class="literal">true</span> &#125; &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span>  <span class="operator">=</span> <span class="string">&quot;Alice&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> T val;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getField(args[<span class="number">1</span>]);</span><br><span class="line">        System.out.format(<span class="string">&quot;Type: %s%n&quot;</span>, f.getType());</span><br><span class="line">        System.out.format(<span class="string">&quot;GenericType: %s%n&quot;</span>, f.getGenericType());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="获取Field的修饰符">获取Field的修饰符</h2><p>field的声明中会包含部分修饰符:</p><ul><li>权限访问修饰符<ul><li><code>public</code></li><li><code>protectded</code></li><li><code>private</code></li></ul></li><li>Field专属运行期修饰符<ul><li>该字段不加入序列化<code>transient</code></li><li>并发写可见 <code>volatile</code></li></ul></li><li>静态修饰符 <code>static</code></li><li>值不可变修饰符 <code>final</code></li><li>注解</li></ul><h3 id="Field-getModifiers"><code>Field.getModifiers()</code></h3><p>方法返回不同修饰符的Int值，<code>Modifier</code>类可以用于解析int值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Spy</span> &#123; BLACK , WHITE &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询修饰符对应field</span></span><br><span class="line"><span class="comment"> * $ java FieldModifierSpy FieldModifierSpy volatile</span></span><br><span class="line"><span class="comment"> * Fields in Class &#x27;FieldModifierSpy&#x27; containing modifiers:  volatile</span></span><br><span class="line"><span class="comment"> * share    [ synthetic=false enum_constant=false ]</span></span><br><span class="line"><span class="comment"> * 引用自</span></span><br><span class="line"><span class="comment"> * http://docs.oracle.com/javase/tutorial/reflect/member/fieldModifiers.html</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldModifierSpy</span> &#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> share;</span><br><span class="line">    <span class="type">int</span> instance;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">int</span> <span class="variable">searchMods</span> <span class="operator">=</span> <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">                  searchMods |= modifierFromString(args[i]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Field[] flds = c.getDeclaredFields();</span><br><span class="line">            out.format(<span class="string">&quot;Fields in Class &#x27;%s&#x27; containing modifiers:  %s%n&quot;</span>,</span><br><span class="line">                   c.getName(),</span><br><span class="line">                   Modifier.toString(searchMods));</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (Field f : flds) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">foundMods</span> <span class="operator">=</span> f.getModifiers();</span><br><span class="line">                <span class="keyword">if</span> ((foundMods &amp; searchMods) == searchMods) &#123;</span><br><span class="line">                    out.format(<span class="string">&quot;%-8s [ synthetic=%-5b enum_constant=%-5b ]%n&quot;</span>,</span><br><span class="line">                           f.getName(), f.isSynthetic(),</span><br><span class="line">                           f.isEnumConstant());</span><br><span class="line">                    found = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">                  out.format(<span class="string">&quot;No matching fields%n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">modifierFromString</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">0x0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;public&quot;</span>.equals(s))           m |= Modifier.PUBLIC;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;protected&quot;</span>.equals(s))   m |= Modifier.PROTECTED;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;private&quot;</span>.equals(s))     m |= Modifier.PRIVATE;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;static&quot;</span>.equals(s))      m |= Modifier.STATIC;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;final&quot;</span>.equals(s))       m |= Modifier.FINAL;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;transient&quot;</span>.equals(s))   m |= Modifier.TRANSIENT;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;volatile&quot;</span>.equals(s))    m |= Modifier.VOLATILE;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Field-isSynthetic"><code>Field.isSynthetic()</code></h2><p><code>isSynthetic()</code>方法可以用来判断field是否是编译器生成的用于内部使用的属性.例如，内部类(不包括静态内部类)中会使用字段<code>this$0</code>指向外部类的对象引用;enums会使用字段<code>$VALUES</code>来实现static方法<code>values()</code>。这些<code>synthetic field</code>被包含在<code>Class.getDeclaredFields()</code>的返回结果中，但不会被包含在<code>Class.getField()</code>中，因为这些<code>synthetic field</code>通常来说不是public的。</p><h3 id="内部类this-0">内部类<code>this$0</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutClass</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InnerClass</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行<code>javac</code>,<code>javap -verbose</code>命令</p><ul><li><code>javac</code></li></ul><p>生成<code>OutClass.class</code>,<code>OutClass$InnerClass.class</code>文件</p><ul><li><code>javap -verbose</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  final OutClass this$0;  //此处是对外部类对象的引用</span><br><span class="line">    descriptor: LOutClass;</span><br><span class="line">    flags: ACC_FINAL, ACC_SYNTHETIC // isSynthetic</span><br><span class="line"></span><br><span class="line">  public OutClass$InnerClass(OutClass);</span><br><span class="line">    descriptor: (LOutClass;)V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=2</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: aload_1</span><br><span class="line">         2: putfield      #1                  // Field this$0:LOutClass;</span><br><span class="line">         5: aload_0</span><br><span class="line">         6: invokespecial #2                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         9: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 2: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Field值的get和set">Field值的get和set</h2><p>对于某个给定的对象，可以使用反射来给对象的属性赋值，这通常发生在无法通过正常方法赋值的场景下。注意，通过反射赋值违反了类的设计初衷，所以使用是应当尽可能的慎重。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Tweedle</span> &#123; DEE, DUM &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * field -&gt; set value</span></span><br><span class="line"><span class="comment"> * 引用自</span></span><br><span class="line"><span class="comment"> * http://docs.oracle.com/javase/tutorial/reflect/member/fieldValues.html</span></span><br><span class="line"><span class="comment"> * $ java Book</span></span><br><span class="line"><span class="comment"> * BEFORE:  chapters     = 0</span></span><br><span class="line"><span class="comment"> *  AFTER:  chapters     = 12</span></span><br><span class="line"><span class="comment"> * BEFORE:  characters   = [Alice, White Rabbit]</span></span><br><span class="line"><span class="comment"> *  AFTER:  characters   = [Queen, King]</span></span><br><span class="line"><span class="comment"> * BEFORE:  twin         = DEE</span></span><br><span class="line"><span class="comment"> *  AFTER:  twin         = DUM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="variable">chapters</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> String[] characters = &#123; <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;White Rabbit&quot;</span> &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Tweedle</span> <span class="variable">twin</span> <span class="operator">=</span> Tweedle.DEE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">fmt</span> <span class="operator">=</span> <span class="string">&quot;%6S:  %-12s = %s%n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = book.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">chap</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;chapters&quot;</span>);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;before&quot;</span>, <span class="string">&quot;chapters&quot;</span>, book.chapters);</span><br><span class="line">        chap.setLong(book, <span class="number">12</span>);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;after&quot;</span>, <span class="string">&quot;chapters&quot;</span>, chap.getLong(book));</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">chars</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;characters&quot;</span>);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;before&quot;</span>, <span class="string">&quot;characters&quot;</span>,</span><br><span class="line">               Arrays.asList(book.characters));</span><br><span class="line">        String[] newChars = &#123; <span class="string">&quot;Queen&quot;</span>, <span class="string">&quot;King&quot;</span> &#125;;</span><br><span class="line">        chars.set(book, newChars);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;after&quot;</span>, <span class="string">&quot;characters&quot;</span>,</span><br><span class="line">               Arrays.asList(book.characters));</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">t</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;twin&quot;</span>);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;before&quot;</span>, <span class="string">&quot;twin&quot;</span>, book.twin);</span><br><span class="line">        t.set(book, Tweedle.DUM);</span><br><span class="line">        out.format(fmt, <span class="string">&quot;after&quot;</span>, <span class="string">&quot;twin&quot;</span>, t.get(book));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>NOTE:<br>通过反射进行赋值需要一定数量性能资源，用于前置操作，例如验证访问权限。从运行期的角度来看，结果是相同的，并且操作和在代码中修改的原子性相同。<br>但是使用反射会失去虚拟机对代码的优化，下面就是个例子，虚拟机会优化，反射却不会。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">x = <span class="number">2</span>;</span><br><span class="line">x = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><h2 id="需要注意的Exception">需要注意的Exception</h2><h3 id="不可转型异常-IllegalArgumentException">不可转型异常 <code>IllegalArgumentException</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldTrouble</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer val;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="type">FieldTrouble</span> <span class="variable">ft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldTrouble</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = ft.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        f.setInt(ft, <span class="number">42</span>); <span class="comment">//IllegalArgumentException</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RESULT:</span></span><br><span class="line"><span class="comment"> * $ java FieldTrouble</span></span><br><span class="line"><span class="comment"> * Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Can not set</span></span><br><span class="line"><span class="comment"> *  java.lang.Object field FieldTrouble.val to (long)42</span></span><br><span class="line"><span class="comment"> *        at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException</span></span><br><span class="line"><span class="comment"> *          (UnsafeFieldAccessorImpl.java:146)</span></span><br><span class="line"><span class="comment"> *        at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException</span></span><br><span class="line"><span class="comment"> *          (UnsafeFieldAccessorImpl.java:174)</span></span><br><span class="line"><span class="comment"> *        at sun.reflect.UnsafeObjectFieldAccessorImpl.setLong</span></span><br><span class="line"><span class="comment"> *          (UnsafeObjectFieldAccessorImpl.java:102)</span></span><br><span class="line"><span class="comment"> *        at java.lang.reflect.Field.setLong(Field.java:831)</span></span><br><span class="line"><span class="comment"> *        at FieldTrouble.main(FieldTrouble.java:11)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><ul><li>对于非反射的表达式<code>Integer val = 42;</code>编译器会将值类型42装箱成包装类<code>new Integer(42)</code>。</li><li>当使用反射时，编译器不会进行装箱。</li></ul><p>要解决上面的问题可以将<code>f.setInt(ft, 42);</code>改为调用<code>Field.set(Object obj, Object value)</code>方法。</p><h3 id="无权限修改异常">无权限修改异常</h3><p>常见于修改private或final属性 <code>IllegalAccessException</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldTroubleToo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="type">FieldTroubleToo</span> <span class="variable">ft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FieldTroubleToo</span>();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = ft.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;b&quot;</span>);</span><br><span class="line"><span class="comment">//      f.setAccessible(true);  // solution</span></span><br><span class="line">        f.setBoolean(ft, Boolean.FALSE);   <span class="comment">// IllegalAccessException</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">        x.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * $ java FieldTroubleToo</span></span><br><span class="line"><span class="comment"> * java.lang.IllegalAccessException: Can not set final boolean field</span></span><br><span class="line"><span class="comment"> *  FieldTroubleToo.b to (boolean)false</span></span><br><span class="line"><span class="comment"> *         at sun.reflect.UnsafeFieldAccessorImpl.</span></span><br><span class="line"><span class="comment"> *           throwFinalFieldIllegalAccessException(UnsafeFieldAccessorImpl.java:55)</span></span><br><span class="line"><span class="comment"> *         at sun.reflect.UnsafeFieldAccessorImpl.</span></span><br><span class="line"><span class="comment"> *           throwFinalFieldIllegalAccessException(UnsafeFieldAccessorImpl.java:63)</span></span><br><span class="line"><span class="comment"> *         at sun.reflect.UnsafeQualifiedBooleanFieldAccessorImpl.setBoolean</span></span><br><span class="line"><span class="comment"> *           (UnsafeQualifiedBooleanFieldAccessorImpl.java:78)</span></span><br><span class="line"><span class="comment"> *         at java.lang.reflect.Field.setBoolean(Field.java:686)</span></span><br><span class="line"><span class="comment"> *         at FieldTroubleToo.main(FieldTroubleToo.java:12)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>解决方案: 调用<code>f.setAccessible(true);</code>方法，提供访问权限.</p><h1 id="反射中的类成员–Method">反射中的类成员–Method</h1><p><code>java.lang.reflect.Method</code> 类提供了用于获取方法修饰符，返回类型，参数，注解和异常的API。同时，还可以通过API来调用方法。</p><h2 id="获取方法声明信息">获取方法声明信息</h2><p>一个方法的声明包含了方法名，修饰符，参数，返回类型和可抛出的异常。下面是一个例子，展示了怎样列举出某个特定类的所有声明方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodSpy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span>  <span class="variable">fmt</span> <span class="operator">=</span> <span class="string">&quot;%24s: %s%n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for the morbidly curious</span></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&gt; <span class="keyword">void</span> <span class="title function_">genericThrow</span><span class="params">()</span> <span class="keyword">throws</span> E &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!m.getName().equals(args[<span class="number">1</span>])) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            out.format(<span class="string">&quot;%s%n&quot;</span>, m.toGenericString());</span><br><span class="line"></span><br><span class="line">            out.format(fmt, <span class="string">&quot;ReturnType&quot;</span>, m.getReturnType());</span><br><span class="line">            out.format(fmt, <span class="string">&quot;GenericReturnType&quot;</span>, m.getGenericReturnType());</span><br><span class="line"></span><br><span class="line">            Class&lt;?&gt;[] pType  = m.getParameterTypes();</span><br><span class="line">            Type[] gpType = m.getGenericParameterTypes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pType.length; i++) &#123;</span><br><span class="line">                out.format(fmt,<span class="string">&quot;ParameterType&quot;</span>, pType[i]);</span><br><span class="line">                out.format(fmt,<span class="string">&quot;GenericParameterType&quot;</span>, gpType[i]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Class&lt;?&gt;[] xType  = m.getExceptionTypes();</span><br><span class="line">            Type[] gxType = m.getGenericExceptionTypes();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; xType.length; i++) &#123;</span><br><span class="line">                out.format(fmt,<span class="string">&quot;ExceptionType&quot;</span>, xType[i]);</span><br><span class="line">                out.format(fmt,<span class="string">&quot;GenericExceptionType&quot;</span>, gxType[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * $ java MethodSpy java.lang.Class getConstructor</span></span><br><span class="line"><span class="comment"> * public java.lang.reflect.Constructor&lt;T&gt; java.lang.Class.getConstructor</span></span><br><span class="line"><span class="comment"> *  (java.lang.Class&lt;?&gt;[]) throws java.lang.NoSuchMethodException,</span></span><br><span class="line"><span class="comment"> *  java.lang.SecurityException</span></span><br><span class="line"><span class="comment"> *              ReturnType: class java.lang.reflect.Constructor</span></span><br><span class="line"><span class="comment"> *       GenericReturnType: java.lang.reflect.Constructor&lt;T&gt;</span></span><br><span class="line"><span class="comment"> *           ParameterType: class [Ljava.lang.Class;</span></span><br><span class="line"><span class="comment"> *    GenericParameterType: java.lang.Class&lt;?&gt;[]</span></span><br><span class="line"><span class="comment"> *           ExceptionType: class java.lang.NoSuchMethodException</span></span><br><span class="line"><span class="comment"> *    GenericExceptionType: class java.lang.NoSuchMethodException</span></span><br><span class="line"><span class="comment"> *           ExceptionType: class java.lang.SecurityException</span></span><br><span class="line"><span class="comment"> *    GenericExceptionType: class java.lang.SecurityException</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><blockquote><p>NOTE: <code>Method.getGenericExceptionTypes()</code>存在的原因是有可能使用泛型异常类型去声明一个方法，但是该方法很少被使用，因为捕获一个泛型异常是不可能的。</p><blockquote><p><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#cannotCatch">官方说明</a></p></blockquote></blockquote><h2 id="获取方法参数">获取方法参数</h2><p><code>java.lang.reflect.Executable.getParameters</code>方法可以获取方法或构造器的参数(类<code>Method</code>和<code>Constructor</code>都继承了类<code>Executable</code>的<code>Executable.getParameters</code>方法)。但是，class文件默认情况下不会存储形参的名称。</p><p>要将正式参数名称存储在class文件中，从而使Reflection API能够检索形参名称，请使用编译器选项 <code>-parameters</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 引用自 https://docs.oracle.com/javase/tutorial/reflect/member/example/MethodParameterSpy.java</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodParameterSpy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span>  <span class="variable">fmt</span> <span class="operator">=</span> <span class="string">&quot;%24s: %s%n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for the morbidly curious</span></span><br><span class="line">    &lt;E <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&gt; <span class="keyword">void</span> <span class="title function_">genericThrow</span><span class="params">()</span> <span class="keyword">throws</span> E &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printClassConstructors</span><span class="params">(Class c)</span> &#123;</span><br><span class="line">        Constructor[] allConstructors = c.getConstructors();</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Number of constructors&quot;</span>, allConstructors.length);</span><br><span class="line">        <span class="keyword">for</span> (Constructor currentConstructor : allConstructors) &#123;</span><br><span class="line">            printConstructor(currentConstructor);</span><br><span class="line">        &#125;  </span><br><span class="line">        Constructor[] allDeclConst = c.getDeclaredConstructors();</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Number of declared constructors&quot;</span>,</span><br><span class="line">            allDeclConst.length);</span><br><span class="line">        <span class="keyword">for</span> (Constructor currentDeclConst : allDeclConst) &#123;</span><br><span class="line">            printConstructor(currentDeclConst);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printClassMethods</span><span class="params">(Class c)</span> &#123;</span><br><span class="line">       Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Number of methods&quot;</span>, allMethods.length);</span><br><span class="line">        <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">            printMethod(m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printConstructor</span><span class="params">(Constructor c)</span> &#123;</span><br><span class="line">        out.format(<span class="string">&quot;%s%n&quot;</span>, c.toGenericString());</span><br><span class="line">        Parameter[] params = c.getParameters();</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Number of parameters&quot;</span>, params.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            printParameter(params[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printMethod</span><span class="params">(Method m)</span> &#123;</span><br><span class="line">        out.format(<span class="string">&quot;%s%n&quot;</span>, m.toGenericString());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Return type&quot;</span>, m.getReturnType());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Generic return type&quot;</span>, m.getGenericReturnType());</span><br><span class="line"></span><br><span class="line">        Parameter[] params = m.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            printParameter(params[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printParameter</span><span class="params">(Parameter p)</span> &#123;</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Parameter class&quot;</span>, p.getType());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Parameter name&quot;</span>, p.getName());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Modifiers&quot;</span>, p.getModifiers());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Is implicit?&quot;</span>, p.isImplicit());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Is name present?&quot;</span>, p.isNamePresent());</span><br><span class="line">        out.format(fmt, <span class="string">&quot;Is synthetic?&quot;</span>, p.isSynthetic());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            printClassConstructors(Class.forName(args[<span class="number">0</span>]));</span><br><span class="line">            printClassMethods(Class.forName(args[<span class="number">0</span>]));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">            x.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleMethods</span>&lt;T&gt; &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">simpleMethod</span><span class="params">(String stringParam, <span class="type">int</span> intParam)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;String: &quot;</span> + stringParam + <span class="string">&quot;, integer: &quot;</span> + intParam); </span><br><span class="line">	    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">varArgsMethod</span><span class="params">(String... manyStrings)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> manyStrings.length;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">methodWithList</span><span class="params">(List&lt;String&gt; listParam)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> listParam.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">genericMethod</span><span class="params">(T[] a, Collection&lt;T&gt; c)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Length of array: &quot;</span> + a.length);</span><br><span class="line">        System.out.println(<span class="string">&quot;Size of collection: &quot;</span> + c.size()); </span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行 MethodParameterSpy 的输出:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodParameterSpy ExampleMethods</span><br><span class="line">Number of constructors: 1</span><br><span class="line"></span><br><span class="line">Constructor <span class="comment">#1</span></span><br><span class="line">public ExampleMethods()</span><br><span class="line"></span><br><span class="line">Number of declared constructors: 1</span><br><span class="line"></span><br><span class="line">Declared constructor <span class="comment">#1</span></span><br><span class="line">public ExampleMethods()</span><br><span class="line"></span><br><span class="line">Number of methods: 4</span><br><span class="line"></span><br><span class="line">Method <span class="comment">#1</span></span><br><span class="line">public boolean ExampleMethods.simpleMethod(java.lang.String,int)</span><br><span class="line">             Return <span class="built_in">type</span>: boolean</span><br><span class="line">     Generic <span class="built_in">return</span> <span class="built_in">type</span>: boolean</span><br><span class="line">         Parameter class: class java.lang.String</span><br><span class="line">          Parameter name: stringParam</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br><span class="line">         Parameter class: int</span><br><span class="line">          Parameter name: intParam</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Method <span class="comment">#2</span></span><br><span class="line">public int ExampleMethods.varArgsMethod(java.lang.String...)</span><br><span class="line">             Return <span class="built_in">type</span>: int</span><br><span class="line">     Generic <span class="built_in">return</span> <span class="built_in">type</span>: int</span><br><span class="line">         Parameter class: class [Ljava.lang.String;</span><br><span class="line">          Parameter name: manyStrings</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Method <span class="comment">#3</span></span><br><span class="line">public boolean ExampleMethods.methodWithList(java.util.List&lt;java.lang.String&gt;)</span><br><span class="line">             Return <span class="built_in">type</span>: boolean</span><br><span class="line">     Generic <span class="built_in">return</span> <span class="built_in">type</span>: boolean</span><br><span class="line">         Parameter class: interface java.util.List</span><br><span class="line">          Parameter name: listParam</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Method <span class="comment">#4</span></span><br><span class="line">public &lt;T&gt; void ExampleMethods.genericMethod(T[],java.util.Collection&lt;T&gt;)</span><br><span class="line">             Return <span class="built_in">type</span>: void</span><br><span class="line">     Generic <span class="built_in">return</span> <span class="built_in">type</span>: void</span><br><span class="line">         Parameter class: class [Ljava.lang.Object;</span><br><span class="line">          Parameter name: a</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br><span class="line">         Parameter class: interface java.util.Collection</span><br><span class="line">          Parameter name: c</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: <span class="literal">false</span></span><br><span class="line">        Is name present?: <span class="literal">true</span></span><br><span class="line">           Is synthetic?: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="Parameter类中的方法">Parameter类中的方法</h2><ul><li>getType：返回参数的声明类型的Class对象。</li><li>getName：返回参数的名称。如果参数的名称存在，则此方法返回.class文件提供的名称。否则，以argN的形式返回，其中N是声明参数的方法中的参数索引。例如，假设您编译了ExampleMethods而未指定-parameters编译器选项。MethodParameterSpy将为方法ExampleMethods.simpleMethod打印以下内容：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public boolean ExampleMethods.simpleMethod(java.lang.String,int)</span><br><span class="line">             Return type: boolean</span><br><span class="line">     Generic return type: boolean</span><br><span class="line">         Parameter class: class java.lang.String</span><br><span class="line">          Parameter name: arg0</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: false</span><br><span class="line">        Is name present?: false</span><br><span class="line">           Is synthetic?: false</span><br><span class="line">         Parameter class: int</span><br><span class="line">          Parameter name: arg1</span><br><span class="line">               Modifiers: 0</span><br><span class="line">            Is implicit?: false</span><br><span class="line">        Is name present?: false</span><br><span class="line">           Is synthetic?: false</span><br></pre></td></tr></table></figure><ul><li>getModifiers ：返回一个整数，表示形式参数拥有的各种特征。该值是以下值的总和：</li></ul><table><thead><tr><th style="text-align:left">值（十进制）</th><th style="text-align:left">值（十六进制）</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">16</td><td style="text-align:left">0×0010</td><td style="text-align:left">声明形式参数 final</td></tr><tr><td style="text-align:left">4096</td><td style="text-align:left">为0x1000</td><td style="text-align:left">形式参数是合成的。或者，可以调用该方法isSynthetic。</td></tr><tr><td style="text-align:left">32768</td><td style="text-align:left">为0x8000</td><td style="text-align:left">该参数在源代码中隐式声明。或者，您可以调用该方法isImplicit</td></tr></tbody></table><ul><li>isImplicit：如果在源代码中隐式声明此参数，则返回true。</li><li>isNamePresent: 如果参数来自.class文件，则返回true。</li><li>isSynthetic：如果在源代码中既未隐式声明也未显式声明此参数，则返回true。</li></ul><h2 id="隐式和合成参数">隐式和合成参数</h2><p>我们知道，在类未定义构造器时，JVM会自动生成默认构造器。在上面的输出中，可以看到:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Number of declared constructors: 1</span><br><span class="line">public ExampleMethods()</span><br></pre></td></tr></table></figure><p>考虑下面这种情况:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodParameterExamples</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InnerClass</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>InnerClass是非静态内部类。它的构造函数也是隐式声明的。但是，这个构造函数将包含一个参数。当Java编译器编译时InnerClass，它会创建一个类似于以下代码的.class文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class MethodParameterExamples &#123; </span><br><span class="line">    public class InnerClass &#123; </span><br><span class="line">        final MethodParameterExamples parent; </span><br><span class="line">        InnerClass（final MethodParameterExamples this$0）&#123; </span><br><span class="line">            parent = this$0; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个内部类的构造器包含一个隐式参数，类型是封装类的类型，MethodParameterSpy将为方法打印:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public MethodParameterExamples$InnerClass(MethodParameterExamples)</span><br><span class="line">         Parameter class: class MethodParameterExamples</span><br><span class="line">          Parameter name: this$0</span><br><span class="line">               Modifiers: 32784</span><br><span class="line">            Is implicit?: true</span><br><span class="line">        Is name present?: true</span><br><span class="line">           Is synthetic?: false</span><br></pre></td></tr></table></figure><p>java 编译器实现的构造器，如果在源代码中没有对应的声明方法(无论是显示声明还是隐式声明)，类初始化方法<code>&lt;clinit&gt;</code>除外。合成构造器是由java 编译器实现的，并且因为不同的java编译器实现，合成构造器也互相不同。以下面的类举例:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodParameterExamples</span> &#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Colors</span> &#123;</span><br><span class="line">        RED, WHITE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当Java编译器遇到enum 的构造器时，它会生成一个<code>.class</code>文件和几个方法,以实现enum的功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Colors</span> <span class="keyword">extends</span> <span class="title class_">java</span>.lang.Enum&lt;Colors&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Colors</span> <span class="variable">RED</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Colors</span>(<span class="string">&quot;RED&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Colors</span> <span class="variable">BLUE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Colors</span>(<span class="string">&quot;WHITE&quot;</span>, <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">static</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Colors</span>[]&#123; RED, BLUE &#125;;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Colors</span><span class="params">(String name, <span class="type">int</span> ordinal)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, ordinal);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Colors[] values()&#123;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Colors <span class="title function_">valueOf</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Colors)java.lang.Enum.valueOf(Colors.class, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 values 和valueOf 是隐式方法,因此，它们的参数名称也是隐式声明的，<code>Colors(String name, int ordinal)</code>是默认构造函数，它是隐式声明的。但是其参数<code>(name, ordinal)</code>并不是隐式声明(默认构造器是无参的)，所以它们是合成参数。</p><blockquote><p>enum 类 默认构造函数的形式参数不是隐式声明的，因为不同的编译器不需要就此构造函数的形式达成一致;另一个 Java 编译器可能为其指定不同的形式参数。</p></blockquote><p>MethodParameterSpy将为方法打印:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">enum Colors:</span><br><span class="line"></span><br><span class="line">Number of constructors: 0</span><br><span class="line"></span><br><span class="line">Number of declared constructors: 1</span><br><span class="line"></span><br><span class="line">Declared constructor #1</span><br><span class="line">private MethodParameterExamples$Colors()</span><br><span class="line">         Parameter class: class java.lang.String</span><br><span class="line">          Parameter name: $enum$name</span><br><span class="line">               Modifiers: 4096</span><br><span class="line">            Is implicit?: false</span><br><span class="line">        Is name present?: true</span><br><span class="line">           Is synthetic?: true</span><br><span class="line">         Parameter class: int</span><br><span class="line">          Parameter name: $enum$ordinal</span><br><span class="line">               Modifiers: 4096</span><br><span class="line">            Is implicit?: false</span><br><span class="line">        Is name present?: true</span><br><span class="line">           Is synthetic?: true</span><br><span class="line"></span><br><span class="line">Number of methods: 2</span><br><span class="line"></span><br><span class="line">Method #1</span><br><span class="line">public static MethodParameterExamples$Colors[]</span><br><span class="line">    MethodParameterExamples$Colors.values()</span><br><span class="line">             Return type: class [LMethodParameterExamples$Colors;</span><br><span class="line">     Generic return type: class [LMethodParameterExamples$Colors;</span><br><span class="line"></span><br><span class="line">Method #2</span><br><span class="line">public static MethodParameterExamples$Colors</span><br><span class="line">    MethodParameterExamples$Colors.valueOf(java.lang.String)</span><br><span class="line">             Return type: class MethodParameterExamples$Colors</span><br><span class="line">     Generic return type: class MethodParameterExamples$Colors</span><br><span class="line">         Parameter class: class java.lang.String</span><br><span class="line">          Parameter name: name</span><br><span class="line">               Modifiers: 32768</span><br><span class="line">            Is implicit?: true</span><br><span class="line">        Is name present?: true</span><br><span class="line">           Is synthetic?: false</span><br></pre></td></tr></table></figure><h2 id="分析方法修饰符">分析方法修饰符</h2><p>方法声明的几个修饰符：</p><ul><li>访问修饰符：public, protected,private</li><li>静态修饰符：static</li><li>禁止修改值的修饰符：final</li><li>需要覆盖的修饰符：abstract</li><li>防止重入的修饰符：synchronized</li><li>指示在另一种编程语言中实现的修饰符：native</li><li>修改器强制严格的浮点行为：strictfp</li><li>注解：Annotations</li></ul><p>下面例子列出了具有给定名称的方法的修饰符。它还显示该方法是合成的（编译器生成的）、可变参数 还是桥接方法（编译器生成的以支持泛型接口）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodModifierSpy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">inc</span><span class="params">()</span> &#123; count++; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">cnt</span><span class="params">()</span> &#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">	    <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!m.getName().equals(args[<span class="number">1</span>])) &#123;</span><br><span class="line">		    <span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		out.format(<span class="string">&quot;%s%n&quot;</span>, m.toGenericString());</span><br><span class="line">		out.format(<span class="string">&quot;  Modifiers:  %s%n&quot;</span>,</span><br><span class="line">			   Modifier.toString(m.getModifiers()));</span><br><span class="line">		out.format(<span class="string">&quot;  [ synthetic=%-5b var_args=%-5b bridge=%-5b ]%n&quot;</span>,</span><br><span class="line">			   m.isSynthetic(), m.isVarArgs(), m.isBridge());</span><br><span class="line">		inc();</span><br><span class="line">	    &#125;</span><br><span class="line">	    out.format(<span class="string">&quot;%d matching overload%s found%n&quot;</span>, cnt(),</span><br><span class="line">		       (cnt() == <span class="number">1</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;s&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle this exception more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的方法为例:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodModifierSpy java.lang.Object wait</span><br><span class="line">public final void java.lang.Object.wait() throws java.lang.InterruptedException</span><br><span class="line">  Modifiers:  public final</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">public final void java.lang.Object.wait(long,int)</span><br><span class="line">  throws java.lang.InterruptedException</span><br><span class="line">  Modifiers:  public final</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">public final native void java.lang.Object.wait(long)</span><br><span class="line">  throws java.lang.InterruptedException</span><br><span class="line">  Modifiers:  public final native</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">3 matching overloads found</span><br><span class="line"></span><br><span class="line">$ java MethodModifierSpy java.lang.StrictMath toRadians</span><br><span class="line">public static double java.lang.StrictMath.toRadians(double)</span><br><span class="line">  Modifiers:  public static strictfp</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">1 matching overload found</span><br><span class="line"></span><br><span class="line">$ java MethodModifierSpy MethodModifierSpy inc</span><br><span class="line">private synchronized void MethodModifierSpy.inc()</span><br><span class="line">  Modifiers: private synchronized</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">1 matching overload found</span><br><span class="line"></span><br><span class="line">$ java MethodModifierSpy java.lang.Class getConstructor</span><br><span class="line">public java.lang.reflect.Constructor&lt;T&gt; java.lang.Class.getConstructor</span><br><span class="line">  (java.lang.Class&lt;T&gt;[]) throws java.lang.NoSuchMethodException,</span><br><span class="line">  java.lang.SecurityException</span><br><span class="line">  Modifiers: public transient</span><br><span class="line">  [ synthetic=false var_args=true bridge=false ]</span><br><span class="line">1 matching overload found</span><br><span class="line"></span><br><span class="line">$ java MethodModifierSpy java.lang.String compareTo</span><br><span class="line">public int java.lang.String.compareTo(java.lang.String)</span><br><span class="line">  Modifiers: public</span><br><span class="line">  [ synthetic=false var_args=false bridge=false ]</span><br><span class="line">public int java.lang.String.compareTo(java.lang.Object)</span><br><span class="line">  Modifiers: public volatile</span><br><span class="line">  [ synthetic=true  var_args=false bridge=true  ]</span><br><span class="line">2 matching overloads found</span><br></pre></td></tr></table></figure><p>注意，Method.isVarArgs() 返回true是指如下结构:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes)</span><br></pre></td></tr></table></figure><p>而不是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Constructor&lt;T&gt; getConstructor(Class&lt;?&gt; [] parameterTypes)</span><br></pre></td></tr></table></figure><p>可以看到 String.compareTo() 包含了两个方法，在 String.java中声明的方法是:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String anotherString)</span>;</span><br></pre></td></tr></table></figure><p>第二个合成方法是用于桥接的，发生这种情况是因为 String 实现了参数化接口 Comparable. 在类型擦除期间，继承的方法 Comparable.compareTo()的参数类型从 java.lang.Object更改为 java.lang.String 。由于在擦除后方法的参数类型不再匹配，因此无法进行重写。这将产生编译时错误，添加桥接方法可避免此问题.</p><p>Method实现了java.lang.reflect.AnnotatedElement。因此，任何带有java.lang.annotation.RetentionPolicy.RUNTIME的运行时注释都可以被检索。</p><h2 id="调用方法">调用方法</h2><p>反射提供了一种在类上调用方法的方法。通常，仅当无法在非反射代码中将类的实例强制转换为所需类型时，才需要执行此操作。使用 java.lang.reflect.Method.invoke() 调用,第一个参数是要在其上调用此特定方法的对象实例(如果方法是 static，则第一个参数应为null).后续参数是方法的参数。如果方法调用引发异常，它将抛出 java.lang.reflect.InvocationTargetException 。可以使用 InvocationTargetException.getCause（） 方法检索该方法的原始异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 搜素所有以test开头的方法，且返回boolean值。参数类型为Locale</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.err;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Deet</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">testDeet</span><span class="params">(Locale l)</span> &#123;</span><br><span class="line">	<span class="comment">// getISO3Language() may throw a MissingResourceException</span></span><br><span class="line">	out.format(<span class="string">&quot;Locale = %s, ISO Language Code = %s%n&quot;</span>, l.getDisplayName(), l.getISO3Language());</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">testFoo</span><span class="params">(Locale l)</span> &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">testBar</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (args.length != <span class="number">4</span>) &#123;</span><br><span class="line">	    err.format(<span class="string">&quot;Usage: java Deet &lt;classname&gt; &lt;langauge&gt; &lt;country&gt; &lt;variant&gt;%n&quot;</span>);</span><br><span class="line">	    <span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    <span class="type">Object</span> <span class="variable">t</span> <span class="operator">=</span> c.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回类中显式声明的所有方法</span></span><br><span class="line">	    Method[] allMethods = c.getDeclaredMethods();</span><br><span class="line">	    <span class="keyword">for</span> (Method m : allMethods) &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">mname</span> <span class="operator">=</span> m.getName();</span><br><span class="line">		<span class="keyword">if</span> (!mname.startsWith(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">		    || (m.getGenericReturnType() != <span class="type">boolean</span>.class)) &#123;</span><br><span class="line">		    <span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> 		Type[] pType = m.getGenericParameterTypes();</span><br><span class="line">         <span class="comment">// 确定定位方法的参数是否与所需的调用兼容</span></span><br><span class="line"> 		<span class="keyword">if</span> ((pType.length != <span class="number">1</span>)</span><br><span class="line">		    || Locale.class.isAssignableFrom(pType[<span class="number">0</span>].getClass())) &#123;</span><br><span class="line"> 		    <span class="keyword">continue</span>;</span><br><span class="line"> 		&#125;</span><br><span class="line"></span><br><span class="line">		out.format(<span class="string">&quot;invoking %s()%n&quot;</span>, mname);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		    m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">		    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> m.invoke(t, <span class="keyword">new</span> <span class="title class_">Locale</span>(args[<span class="number">1</span>], args[<span class="number">2</span>], args[<span class="number">3</span>]));</span><br><span class="line">		    out.format(<span class="string">&quot;%s() returned %b%n&quot;</span>, mname, (Boolean) o);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Handle any exceptions thrown by method to be invoked.</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">		    <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> x.getCause();</span><br><span class="line">		    err.format(<span class="string">&quot;invocation of %s failed: %s%n&quot;</span>,</span><br><span class="line">			       mname, cause.getMessage());</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用例子</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ java Deet Deet ja JP JP</span><br><span class="line">invoking testDeet()</span><br><span class="line">Locale = Japanese (Japan,JP), </span><br><span class="line">ISO Language Code = jpn</span><br><span class="line">testDeet() returned <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">$ java Deet Deet xx XX XX</span><br><span class="line">invoking testDeet()</span><br><span class="line">invocation of testDeet failed: </span><br><span class="line">Couldn<span class="string">&#x27;t find 3-letter language code for xx</span></span><br></pre></td></tr></table></figure><p>Method.invoke()可用于将可变数量的参数传递给方法。可变变量的方法的实现就像变量参数打包在数组中一样。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvokeMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    Class[] argTypes = <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; String[].class &#125;;</span><br><span class="line">	    <span class="type">Method</span> <span class="variable">main</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;main&quot;</span>, argTypes);</span><br><span class="line">  	    String[] mainArgs = Arrays.copyOfRange(args, <span class="number">1</span>, args.length);</span><br><span class="line">	    System.out.format(<span class="string">&quot;invoking %s.main()%n&quot;</span>, c.getName());</span><br><span class="line">	    main.invoke(<span class="literal">null</span>, (Object)mainArgs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Exception">Exception</h2><h3 id="由于类型擦除引起的异常-NoSuchMethodException。">由于类型擦除引起的异常,NoSuchMethodException。</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodTrouble</span>&lt;T&gt;  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lookup</span><span class="params">(T t)</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">find</span><span class="params">(Integer i)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="type">String</span> <span class="variable">mName</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">	    <span class="type">Class</span> <span class="variable">cArg</span> <span class="operator">=</span> Class.forName(args[<span class="number">1</span>]);</span><br><span class="line">	    Class&lt;?&gt; c = (<span class="keyword">new</span> <span class="title class_">MethodTrouble</span>&lt;Integer&gt;()).getClass();</span><br><span class="line">	    <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getMethod(mName, cArg);</span><br><span class="line">	    System.out.format(<span class="string">&quot;Found:%n  %s%n&quot;</span>, m.toGenericString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line">$ java MethodTrouble lookup java.lang.Integer</span><br><span class="line">java.lang.NoSuchMethodException: MethodTrouble.lookup(java.lang.Integer)</span><br><span class="line">        at java.lang.Class.getMethod(Class.java:<span class="number">1605</span>)</span><br><span class="line">        at MethodTrouble.main(MethodTrouble.java:<span class="number">12</span>)</span><br><span class="line">$ java MethodTrouble lookup java.lang.Object</span><br><span class="line">Found:</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> MethodTrouble.lookup(T)</span><br></pre></td></tr></table></figure><p>当使用泛型参数类型声明方法时，编译器会将泛型类型替换为其上限，在本例中，上限为 Object。因此，当代码搜索 时，找不到任何lookup方法.</p><h3 id="非法访问产生的IllegalAccessException">非法访问产生的IllegalAccessException</h3><p>如果尝试调用私有或以其他方式无法访问的方法，会产生异常IllegalAccessException</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnotherClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">m</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodTroubleAgain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="type">AnotherClass</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnotherClass</span>();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = ac.getClass();</span><br><span class="line"> 	    <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;m&quot;</span>);</span><br><span class="line">         <span class="comment">// 通过 AccessibleObject.setAccessible()禁止此检查的功能。</span></span><br><span class="line"><span class="comment">//  	    m.setAccessible(true);      // solution</span></span><br><span class="line"> 	    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> m.invoke(ac);    <span class="comment">// IllegalAccessException</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line">$ java MethodTroubleAgain</span><br><span class="line">java.lang.IllegalAccessException: Class MethodTroubleAgain can not access a</span><br><span class="line">  member of <span class="keyword">class</span> <span class="title class_">AnotherClass</span> with modifiers <span class="string">&quot;private&quot;</span></span><br><span class="line">        at sun.reflect.Reflection.ensureMemberAccess(Reflection.java:<span class="number">65</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">588</span>)</span><br><span class="line">        at MethodTroubleAgain.main(MethodTroubleAgain.java:<span class="number">15</span>)</span><br></pre></td></tr></table></figure><h3 id="IllegalArgumentException">IllegalArgumentException</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodTroubleToo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ping</span><span class="params">()</span> &#123; System.out.format(<span class="string">&quot;PONG!%n&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="type">MethodTroubleToo</span> <span class="variable">mtt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodTroubleToo</span>();</span><br><span class="line">	    <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> MethodTroubleToo.class.getMethod(<span class="string">&quot;ping&quot;</span>);</span><br><span class="line"></span><br><span class="line"> 	    <span class="keyword">switch</span>(Integer.parseInt(args[<span class="number">0</span>])) &#123;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">  		m.invoke(mtt);                 <span class="comment">// works</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"> 		m.invoke(mtt, <span class="literal">null</span>);           <span class="comment">// works (expect compiler warning)</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		<span class="type">Object</span> <span class="variable">arg2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		m.invoke(mtt, arg2);           <span class="comment">// IllegalArgumentException</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		m.invoke(mtt, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);  <span class="comment">// works</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">		<span class="type">Object</span> <span class="variable">arg4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">		m.invoke(mtt, arg4);           <span class="comment">// IllegalArgumentException</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	    <span class="keyword">default</span>:</span><br><span class="line">		System.out.format(<span class="string">&quot;Test not found%n&quot;</span>);</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ java MethodTroubleToo <span class="number">0</span></span><br><span class="line">PONG!</span><br></pre></td></tr></table></figure><p>由于 Method.invoke() 的所有参数（第一个参数除外）都是可选的，因此当要调用的方法没有参数时，可以省略它们。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodTroubleToo <span class="number">1</span></span><br><span class="line">PONG!</span><br></pre></td></tr></table></figure><p>在这种情况下，代码会生成此编译器警告，因为null是不明确的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ javac MethodTroubleToo.java</span><br><span class="line">MethodTroubleToo.java:16: warning: non-varargs call of varargs method with</span><br><span class="line">  inexact argument type for last parameter;</span><br><span class="line"> 		m.invoke(mtt, null);           // works (expect compiler warning)</span><br><span class="line"> 		              ^</span><br><span class="line">  cast to Object for a varargs call</span><br><span class="line">  cast to Object[] for a non-varargs call and to suppress this warning</span><br><span class="line">1 warning</span><br></pre></td></tr></table></figure><p>无法确定null是表示空参数数组还是 第一个参数.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodTroubleToo <span class="number">2</span></span><br><span class="line">java.lang.IllegalArgumentException: wrong number of arguments</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke</span><br><span class="line">          (NativeMethodAccessorImpl.java:<span class="number">39</span>)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke</span><br><span class="line">          (DelegatingMethodAccessorImpl.java:<span class="number">25</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">597</span>)</span><br><span class="line">        at MethodTroubleToo.main(MethodTroubleToo.java:<span class="number">21</span>)</span><br></pre></td></tr></table></figure><p>尽管参数是null ，但这个还是失败，是因为该类型是一个 Object，并且ping()根本不需要任何参数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodTroubleToo <span class="number">3</span></span><br><span class="line">PONG!</span><br></pre></td></tr></table></figure><p>这之所以有效，是因为创建一个空数组 <code>new Object[0]</code>，这等效于不传递任何可选参数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ java MethodTroubleToo <span class="number">4</span></span><br><span class="line">java.lang.IllegalArgumentException: wrong number of arguments</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0</span><br><span class="line">          (Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke</span><br><span class="line">          (NativeMethodAccessorImpl.java:<span class="number">39</span>)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke</span><br><span class="line">          (DelegatingMethodAccessorImpl.java:<span class="number">25</span>)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:<span class="number">597</span>)</span><br><span class="line">        at MethodTroubleToo.main(MethodTroubleToo.java:<span class="number">28</span>)</span><br></pre></td></tr></table></figure><p>与前面的示例不同，如果空数组存储在 Object 中，则将其视为 Object。这与案例 2 失败的原因相同，ping()不需要参数。</p><h3 id="InvocationTargetException">InvocationTargetException</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodTroubleReturns</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">drinkMe</span><span class="params">(<span class="type">int</span> liters)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (liters &lt; <span class="number">0</span>)</span><br><span class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;I can&#x27;t drink a negative amount of liquid&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="type">MethodTroubleReturns</span> <span class="variable">mtr</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodTroubleReturns</span>();</span><br><span class="line"> 	    Class&lt;?&gt; c = mtr.getClass();</span><br><span class="line">   	    <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;drinkMe&quot;</span>, <span class="type">int</span>.class);</span><br><span class="line">	    m.invoke(mtr, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> x.getCause();</span><br><span class="line">	    System.err.format(<span class="string">&quot;drinkMe() failed: %s%n&quot;</span>, cause.getMessage());</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ java MethodTroubleReturns</span><br><span class="line"><span class="title function_">drinkMe</span><span class="params">()</span> failed: I can<span class="string">&#x27;t drink a negative amount of liquid</span></span><br></pre></td></tr></table></figure><h1 id="反射中的类成员–Constructor">反射中的类成员–Constructor</h1><p><code>java.lang.reflect.Constructor</code> 表示类的构造器。</p><h2 id="查找构造函数">查找构造函数</h2><p>示例说明了如何在类的声明构造函数中搜索具有给定类型参数的构造函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstructorSift</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; cArg = Class.forName(args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    Constructor[] allConstructors = c.getDeclaredConstructors();</span><br><span class="line">	    <span class="keyword">for</span> (Constructor ctor : allConstructors) &#123;</span><br><span class="line">		Class&lt;?&gt;[] pType  = ctor.getParameterTypes();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pType.length; i++) &#123;</span><br><span class="line">		    <span class="keyword">if</span> (pType[i].equals(cArg)) &#123;</span><br><span class="line">			out.format(<span class="string">&quot;%s%n&quot;</span>, ctor.toGenericString());</span><br><span class="line"></span><br><span class="line">			Type[] gpType = ctor.getGenericParameterTypes();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; gpType.length; j++) &#123;</span><br><span class="line">			    <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> (pType[j].equals(cArg) ? <span class="string">&#x27;*&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">			    out.format(<span class="string">&quot;%7c%s[%d]: %s%n&quot;</span>, ch,</span><br><span class="line">				       <span class="string">&quot;GenericParameterType&quot;</span>, j, gpType[j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		    &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle this exception more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Method.getGenericParameterTypes()将查阅类文件中的签名属性（如果存在）。如果该属性不可用，它将回退到 Method.getParameterType(). 该类型未因泛型的引入而更改.</p><h2 id="分析构造函数修饰符">分析构造函数修饰符</h2><p>构造函数的修饰符较少:</p><ul><li>访问修饰符：public,protected,private</li><li>注解：Annotations</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstructorAccess</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    Constructor[] allConstructors = c.getDeclaredConstructors();</span><br><span class="line">	    <span class="keyword">for</span> (Constructor ctor : allConstructors) &#123;</span><br><span class="line">		<span class="type">int</span> <span class="variable">searchMod</span> <span class="operator">=</span> modifierFromString(args[<span class="number">1</span>]);</span><br><span class="line">		<span class="type">int</span> <span class="variable">mods</span> <span class="operator">=</span> accessModifiers(ctor.getModifiers());</span><br><span class="line">		<span class="keyword">if</span> (searchMod == mods) &#123;</span><br><span class="line">		    out.format(<span class="string">&quot;%s%n&quot;</span>, ctor.toGenericString());</span><br><span class="line">		    out.format(<span class="string">&quot;  [ synthetic=%-5b var_args=%-5b ]%n&quot;</span>,</span><br><span class="line">			       ctor.isSynthetic(), ctor.isVarArgs());</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle this exception more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">accessModifiers</span><span class="params">(<span class="type">int</span> m)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m &amp; (Modifier.PUBLIC | Modifier.PRIVATE | Modifier.PROTECTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">modifierFromString</span><span class="params">(String s)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="string">&quot;public&quot;</span>.equals(s))               <span class="keyword">return</span> Modifier.PUBLIC;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;protected&quot;</span>.equals(s))       <span class="keyword">return</span> Modifier.PROTECTED;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;private&quot;</span>.equals(s))         <span class="keyword">return</span> Modifier.PRIVATE;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;package-private&quot;</span>.equals(s)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -----------------</span></span><br><span class="line">$ java ConstructorAccess java.io.File <span class="keyword">private</span></span><br><span class="line"><span class="keyword">private</span> java.io.File(java.lang.String,<span class="type">int</span>)</span><br><span class="line">  [ synthetic=<span class="literal">false</span> var_args=<span class="literal">false</span> ]</span><br><span class="line"><span class="keyword">private</span> java.io.File(java.lang.String,java.io.File)</span><br><span class="line">  [ synthetic=<span class="literal">false</span> var_args=<span class="literal">false</span> ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="创建新的类实例">创建新的类实例</h2><p>有两种反射方法可用于创建类的实例：java.lang.reflect.Constructor.newInstance() 和 Class.newInstance() 。前者是优选的，因为：</p><ul><li>Class.newInstance() 只能调用零参数构造函数，而 Constructor.newInstance()可以调用任何构造函数，而不管参数的数量如何。</li><li>Class.newInstance() 会引发构造函数引发的任何异常，无论它是检查还是未检查。Constructor.newInstance()总是用 InvocationTargetException 包装抛出的异常。</li><li>Class.newInstance() 要求构造函数是可见的;Constructor.newInstance()在某些情况下可以调用private构造函数。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Console;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleCharset</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	Constructor[] ctors = Console.class.getDeclaredConstructors();</span><br><span class="line">	<span class="type">Constructor</span> <span class="variable">ctor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ctors.length; i++) &#123;</span><br><span class="line">	    ctor = ctors[i];</span><br><span class="line">	    <span class="keyword">if</span> (ctor.getGenericParameterTypes().length == <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    ctor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"> 	    <span class="type">Console</span> <span class="variable">c</span> <span class="operator">=</span> (Console)ctor.newInstance();</span><br><span class="line">	    <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getClass().getDeclaredField(<span class="string">&quot;cs&quot;</span>);</span><br><span class="line">	    f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	    out.format(<span class="string">&quot;Console charset         :  %s%n&quot;</span>, f.get(c));</span><br><span class="line">	    out.format(<span class="string">&quot;Charset.defaultCharset():  %s%n&quot;</span>,</span><br><span class="line">		       Charset.defaultCharset());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line"> 	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line"> 	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UNIX 系统的示例输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ java ConsoleCharset</span><br><span class="line">Console charset          :  ISO-8859-1</span><br><span class="line">Charset.defaultCharset() :  ISO-8859-1</span><br></pre></td></tr></table></figure><p>Constructor.newInstance() 的另一个常见应用是调用采用参数的构造函数.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailAliases</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; aliases;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EmailAliases</span><span class="params">(HashMap&lt;String, String&gt; h)</span> &#123;</span><br><span class="line">	aliases = h.keySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printKeys</span><span class="params">()</span> &#123;</span><br><span class="line">	out.format(<span class="string">&quot;Mail keys:%n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (String k : aliases)</span><br><span class="line">	    out.format(<span class="string">&quot;  %s%n&quot;</span>, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestoreAliases</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; defaultAliases = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">	defaultAliases.put(<span class="string">&quot;Duke&quot;</span>, <span class="string">&quot;duke@i-love-java&quot;</span>);</span><br><span class="line">	defaultAliases.put(<span class="string">&quot;Fang&quot;</span>, <span class="string">&quot;fang@evil-jealous-twin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="type">Constructor</span> <span class="variable">ctor</span> <span class="operator">=</span> EmailAliases.class.getDeclaredConstructor(HashMap.class);</span><br><span class="line">	    ctor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	    <span class="type">EmailAliases</span> <span class="variable">email</span> <span class="operator">=</span> (EmailAliases)ctor.newInstance(defaultAliases);</span><br><span class="line">	    email.printKeys();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// -----------------------------------------</span></span><br><span class="line">$ java RestoreAliases</span><br><span class="line">Mail keys:</span><br><span class="line">  Duke</span><br><span class="line">  Fang</span><br></pre></td></tr></table></figure><h1 id="Array">Array</h1><p>数组类型可以通过调用 Class.isArray()来标识。反射支持通过java.lang.reflect.Array.newInstance()动态创建任意类型和维度的数组的能力.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个能够动态创建数组的基本解释器。将解析的语法如下：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fully_qualified_class_name variable_name[] = </span></span><br><span class="line"><span class="comment">//     &#123; val1, val2, val3, ... &#125;</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayCreator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;java.math.BigInteger bi[] = &#123; 123, 234, 345 &#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Pattern</span> <span class="variable">p</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^\\s*(\\S+)\\s*\\w+\\[\\].*\\&#123;\\s*([^&#125;]+)\\s*\\&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">m</span> <span class="operator">=</span> p.matcher(s);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m.find()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">cName</span> <span class="operator">=</span> m.group(<span class="number">1</span>);</span><br><span class="line">            String[] cVals = m.group(<span class="number">2</span>).split(<span class="string">&quot;[\\s,]+&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cVals.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt; c = Class.forName(cName);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Array.newInstance(c, n);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">v</span> <span class="operator">=</span> cVals[i];</span><br><span class="line">                    <span class="type">Constructor</span> <span class="variable">ctor</span> <span class="operator">=</span> c.getConstructor(String.class);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">val</span> <span class="operator">=</span> ctor.newInstance(v);</span><br><span class="line">                    Array.set(o, i, val);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Object[] oo = (Object[])o;</span><br><span class="line">                out.format(<span class="string">&quot;%s[] = %s%n&quot;</span>, cName, Arrays.toString(oo));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">                x.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException x) &#123;</span><br><span class="line">                x.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">                x.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException x) &#123;</span><br><span class="line">                x.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException x) &#123;</span><br><span class="line">                x.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ java ArrayCreator</span><br><span class="line">java.math.BigInteger [] = [<span class="number">123</span>, <span class="number">234</span>, <span class="number">345</span>]</span><br></pre></td></tr></table></figure><h2 id="数组的操作">数组的操作</h2><ul><li>java.lang.reflect.Field.set(Object obj，Object value) : 设置数组的值</li><li>java.lang.reflect.Field.get(Object): 获取数组的值</li><li>java.lang.reflect.Array 提供了对数组内部操作的方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateMatrix</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">matrix</span> <span class="operator">=</span> Array.newInstance(<span class="type">int</span>.class, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">row0</span> <span class="operator">=</span> Array.get(matrix, <span class="number">0</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">row1</span> <span class="operator">=</span> Array.get(matrix, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Array.setInt(row0, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        Array.setInt(row0, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        Array.setInt(row1, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        Array.setInt(row1, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">2</span>; j++)</span><br><span class="line">                out.format(<span class="string">&quot;matrix[%d][%d] = %d%n&quot;</span>, i, j, ((<span class="type">int</span>[][])matrix)[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ java CreateMatrix</span><br><span class="line">matrix[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">matrix[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">matrix[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">matrix[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">4</span></span><br></pre></td></tr></table></figure><blockquote><p>Array.newInstance(Class&lt;？&gt; componentType， int… dimensions) 提供了一种创建多维数组的便捷方法</p></blockquote><h1 id="enum">enum</h1><ul><li>Class.isEnum() 指示此类是否表示枚举类型</li><li>Class.getEnumConstants() 检索枚举常量的列表，这些枚举常量按声明的顺序进行定义,返回的值与调用枚举类型values()返回的值相同。</li><li>java.lang.reflect.Field.isEnumConstant() 指示此字段是否表示枚举类型的元素</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Eon</span> &#123; HADEAN, ARCHAEAN, PROTEROZOIC, PHANEROZOIC &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumConstants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = (args.length == <span class="number">0</span> ? Eon.class : Class.forName(args[<span class="number">0</span>]));</span><br><span class="line">	    out.format(<span class="string">&quot;Enum name:  %s%nEnum constants:  %s%n&quot;</span>,</span><br><span class="line">		       c.getName(), Arrays.asList(c.getEnumConstants()));</span><br><span class="line">	    <span class="keyword">if</span> (c == Eon.class)</span><br><span class="line">		out.format(<span class="string">&quot;  Eon.values():  %s%n&quot;</span>,</span><br><span class="line">			   Arrays.asList(Eon.values()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle this exception more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---------------------</span></span><br><span class="line">$ java EnumConstants java.lang.annotation.RetentionPolicy</span><br><span class="line">Enum name:  java.lang.annotation.RetentionPolicy</span><br><span class="line">Enum constants:  [SOURCE, CLASS, RUNTIME]</span><br><span class="line">$ java EnumConstants java.util.concurrent.TimeUnit</span><br><span class="line">Enum name:  java.util.concurrent.TimeUnit</span><br><span class="line">Enum constants:  [NANOSECONDS, MICROSECONDS, </span><br><span class="line">                  MILLISECONDS, SECONDS, </span><br><span class="line">                  MINUTES, HOURS, DAYS]</span><br></pre></td></tr></table></figure><p>由于enum实际上是类，可以用上面的反射方法获取 字段、方法和构造函数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Member;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumSpy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fmt</span> <span class="operator">=</span> <span class="string">&quot;  %11s:  %s %s%n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">	    <span class="keyword">if</span> (!c.isEnum()) &#123;</span><br><span class="line">		out.format(<span class="string">&quot;%s is not an enum type%n&quot;</span>, c);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	    out.format(<span class="string">&quot;Class:  %s%n&quot;</span>, c);</span><br><span class="line"></span><br><span class="line">	    Field[] flds = c.getDeclaredFields();</span><br><span class="line">	    List&lt;Field&gt; cst = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Field&gt;();  <span class="comment">// enum constants</span></span><br><span class="line">	    List&lt;Field&gt; mbr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Field&gt;();  <span class="comment">// member fields</span></span><br><span class="line">	    <span class="keyword">for</span> (Field f : flds) &#123;</span><br><span class="line">		<span class="keyword">if</span> (f.isEnumConstant())</span><br><span class="line">		    cst.add(f);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		    mbr.add(f);</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">if</span> (!cst.isEmpty())</span><br><span class="line">		print(cst, <span class="string">&quot;Constant&quot;</span>);</span><br><span class="line">	    <span class="keyword">if</span> (!mbr.isEmpty())</span><br><span class="line">		print(mbr, <span class="string">&quot;Field&quot;</span>);</span><br><span class="line"></span><br><span class="line">	    Constructor[] ctors = c.getDeclaredConstructors();</span><br><span class="line">	    <span class="keyword">for</span> (Constructor ctor : ctors) &#123;</span><br><span class="line">		out.format(fmt, <span class="string">&quot;Constructor&quot;</span>, ctor.toGenericString(),</span><br><span class="line">			   synthetic(ctor));</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">	    Method[] mths = c.getDeclaredMethods();</span><br><span class="line">	    <span class="keyword">for</span> (Method m : mths) &#123;</span><br><span class="line">		out.format(fmt, <span class="string">&quot;Method&quot;</span>, m.toGenericString(),</span><br><span class="line">			   synthetic(m));</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle this exception more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (ClassNotFoundException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(List&lt;Field&gt; lst, String s)</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (Field f : lst) &#123;</span><br><span class="line"> 	    out.format(fmt, s, f.toGenericString(), synthetic(f));</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">synthetic</span><span class="params">(Member m)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (m.isSynthetic() ? <span class="string">&quot;[ synthetic ]&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ java EnumSpy java.lang.annotation.RetentionPolicy</span><br><span class="line">Class:  <span class="keyword">class</span> <span class="title class_">java</span>.lang.annotation.RetentionPolicy</span><br><span class="line">     Constant:  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.annotation.RetentionPolicy</span><br><span class="line">                  java.lang.annotation.RetentionPolicy.SOURCE </span><br><span class="line">     Constant:  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.annotation.RetentionPolicy</span><br><span class="line">                  java.lang.annotation.RetentionPolicy.CLASS </span><br><span class="line">     Constant:  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.annotation.RetentionPolicy </span><br><span class="line">                  java.lang.annotation.RetentionPolicy.RUNTIME </span><br><span class="line">        Field:  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.annotation.RetentionPolicy[] </span><br><span class="line">                  java.lang.annotation.RetentionPolicy. [ synthetic ]</span><br><span class="line">  Constructor:  <span class="keyword">private</span> java.lang.annotation.RetentionPolicy() </span><br><span class="line">       Method:  <span class="keyword">public</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy[]</span><br><span class="line">                  java.lang.annotation.RetentionPolicy.values() </span><br><span class="line">       Method:  <span class="keyword">public</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy</span><br><span class="line">                  java.lang.annotation.RetentionPolicy.valueOf(java.lang.String) </span><br></pre></td></tr></table></figure><blockquote><p>Class.getFields()和 Class.getDeclaredFields() 不保证返回值的顺序与声明源代码中的顺序匹配。如果应用程序需要排序，请使用 Class.getEnumConstants()</p></blockquote><ul><li>java.lang.reflect.Field.set(Object obj，Object value) : 设置enum的值</li><li>java.lang.reflect.Field.get(Object): 获取enum的值</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.System.out;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">TraceLevel</span> &#123; OFF, LOW, MEDIUM, HIGH, DEBUG &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">TraceLevel</span> <span class="variable">level</span> <span class="operator">=</span> TraceLevel.OFF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetTrace</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">	<span class="type">TraceLevel</span> <span class="variable">newLevel</span> <span class="operator">=</span> TraceLevel.valueOf(args[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="type">MyServer</span> <span class="variable">svr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServer</span>();</span><br><span class="line">	    Class&lt;?&gt; c = svr.getClass();</span><br><span class="line">	    <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;level&quot;</span>);</span><br><span class="line">	    f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	    <span class="type">TraceLevel</span> <span class="variable">oldLevel</span> <span class="operator">=</span> (TraceLevel)f.get(svr);</span><br><span class="line">	    out.format(<span class="string">&quot;Original trace level:  %s%n&quot;</span>, oldLevel);</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">if</span> (oldLevel != newLevel) &#123;</span><br><span class="line"> 		f.set(svr, newLevel);</span><br><span class="line">		out.format(<span class="string">&quot;    New  trace level:  %s%n&quot;</span>, f.get(svr));</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// production code should handle these exceptions more gracefully</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalArgumentException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IllegalAccessException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (NoSuchFieldException x) &#123;</span><br><span class="line">	    x.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="reward-container"><div>请我一杯咖啡吧！</div><button>赞赏</button><div class="post-reward"><div><img src="/images/weixinpay.webp" alt="Victor Chu 微信"> <span>微信</span></div><div><img src="/images/alpay.webp" alt="Victor Chu 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Victor Chu</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.victorchu.info/posts/fa358471/" title="Java 反射">https://www.victorchu.info/posts/fa358471/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/images/wechat_channel.webp"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div></div></div><div class="post-tags"><a href="/tags/Reflect/" rel="tag"><i class="fa fa-tag"></i> Reflect</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/1e5969ed/" rel="prev" title="Java引用"><i class="fa fa-angle-left"></i> Java引用</a></div><div class="post-nav-item"><a href="/posts/27de9f3b/" rel="next" title="Java注解">Java注解 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备18037908号-1 </a><img src="/images/gongan_icon.webp" alt=""><a href="https://beian.mps.gov.cn/#/query/webSearch?code=33010902002043" rel="noopener" target="_blank">浙公网安备 33010902002043号</a></div><div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Victor Chu</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">1.7m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">47:13</span></span></div><div class="powered-by">由<a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" class="theme-link" rel="noopener" target="_blank"><img src="/images/upyun_logo.webp" width="50" style="display:inline"></a>提供CDN服务</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.23.3/algoliasearch-lite.umd.js" integrity="sha256-1QNshz86RqXe/qsCBldsUu13eAX6n/O98uubKQs87UI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.67.0/instantsearch.production.min.js" integrity="sha256-TW7D3X/i/W+RUgEeDppEnFT2ixv5lzplKH0c58D92dY=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"default","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/fancybox.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous"><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"walineui.victorchu.info","cssUrl":"https://cdn.staticfile.org/waline/2.15.8/waline.css","commentCount":true,"pageview":true,"requiredMeta":["nick","mail"],"login":"force","libUrl":"https://cdn.staticfile.org/waline/2.15.8/waline.js","el":"#waline","comment":true,"path":"/posts/fa358471/"}</script><link rel="stylesheet" href="https://cdn.staticfile.org/waline/2.15.8/waline.css"><script>document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});</script></body></html>