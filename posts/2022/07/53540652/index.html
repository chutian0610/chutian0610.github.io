<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Lightweight Asynchronous Snapshots for Distributed Dataflows - Victor's Code Journey</title><meta name=Description content><meta property="og:url" content="http://www.victorchu.info/posts/2022/07/53540652/"><meta property="og:site_name" content="Victor's Code Journey"><meta property="og:title" content="Lightweight Asynchronous Snapshots for Distributed Dataflows"><meta property="og:description" content="本篇是论文Lightweight Asynchronous Snapshots for Distributed Dataflows的中文简单翻译"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-20T16:46:33+08:00"><meta property="article:modified_time" content="2026-02-28T17:14:49+08:00"><meta property="article:tag" content="BigData"><meta property="article:tag" content="Distributed"><meta property="og:image" content="http://www.victorchu.info/posts/2022/07/53540652/recovery.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.victorchu.info/posts/2022/07/53540652/recovery.webp"><meta name=twitter:title content="Lightweight Asynchronous Snapshots for Distributed Dataflows"><meta name=twitter:description content="本篇是论文Lightweight Asynchronous Snapshots for Distributed Dataflows的中文简单翻译"><meta name=application-name content="Victor's Code Journey"><meta name=apple-mobile-web-app-title content="Victor's Code Journey"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=http://www.victorchu.info/posts/2022/07/53540652/><link rel=prev href=http://www.victorchu.info/posts/2022/07/78e26fb6/><link rel=next href=http://www.victorchu.info/posts/2022/07/231ca7f/><link rel=stylesheet href=/css/main.min.css><link rel=stylesheet href=/css/style.min.css><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Lightweight Asynchronous Snapshots for Distributed Dataflows","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.victorchu.info/posts/2022/07/53540652/"},"image":[{"@type":"ImageObject","url":"http://www.victorchu.info/feature-images/paper.webp","width":600,"height":338}],"genre":"posts","keywords":["BigData","Distributed"],"wordcount":7861,"url":"http://www.victorchu.info/posts/2022/07/53540652/","datePublished":"2022-07-20T16:46:33+08:00","dateModified":"2026-02-28T17:14:49+08:00","publisher":{"@type":"Organization","name":"victorchutian"},"author":[{"@type":"Person","name":"victorchutian","url":"http://www.victorchu.info/authors/victorchutian/"}],"description":""}</script></head><body data-instant-intensity=viewport class="tw-flex tw-min-h-screen tw-flex-col"><script>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.className=e,document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),e==="light"?document.documentElement.classList.remove("tw-dark"):document.documentElement.classList.add("tw-dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#161b22"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><header class="desktop print:!tw-hidden" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Victor's Code Journey"><img class="tw-inline tw-align-text-bottom tw-mr-1" src=/images/blog-solid.svg alt="Victor's Code Journey" height=32 width=32><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/series/>系列 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search ..." id=search-input-desktop>
<button class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<svg class="icon" viewBox="0 0 512 512"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</button>
<button class="search-button search-clear" id=search-clear-desktop title=清空>
<svg class="icon" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3.0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3.0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3.0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3.0 17L312 256l65.6 65.1z"/></svg>
</button>
<span class="search-button search-loading tw-animate-spin" id=search-loading-desktop><svg class="icon" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49.0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156.0c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
</span></span><button class="menu-item theme-switch" aria-label=切换主题>
<svg class="icon" viewBox="0 0 512 512"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705.0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg></button></div></div></div></header><header class="mobile print:!tw-hidden" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Victor's Code Journey"><img class="tw-inline tw-align-text-bottom tw-mr-1" src=/images/blog-solid.svg alt="Victor's Code Journey" height=32 width=32><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search ..." id=search-input-mobile>
<button class="search-button search-toggle tw-h-10" id=search-toggle-mobile title=搜索>
<svg class="icon" viewBox="0 0 512 512"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</button>
<button class="search-button search-clear tw-h-fit" id=search-clear-mobile title=清空>
<svg class="icon" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3.0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3.0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3.0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3.0 17L312 256l65.6 65.1z"/></svg>
</button>
<span class="search-button search-loading tw-animate-spin" id=search-loading-mobile><svg class="icon" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49.0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156.0c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg></span></div><button class=search-cancel id=search-cancel-mobile>
取消</button></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/series/ title>系列</a><a class=menu-item href=/about/ title>关于</a><button class="menu-item theme-switch tw-w-full" aria-label=切换主题>
<svg class="icon" viewBox="0 0 512 512"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705.0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg></button></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class="tw-mx-4 tw-flex-1"><div class="toc print:!tw-hidden" id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#介绍>介绍</a></li><li><a href=#相关工作>相关工作</a></li><li><a href=#背景-apache-flink-系统>背景: Apache Flink 系统</a><ul><li><a href=#流处理模型>流处理模型</a></li><li><a href=#分布式数据流执行>分布式数据流执行</a></li></ul></li><li><a href=#异步屏障快照abs>异步屏障快照(ABS)</a><ul><li><a href=#问题定义>问题定义</a></li><li><a href=#无环数据流拓扑的abs>无环数据流拓扑的ABS</a><ul><li><a href=#简要证明>简要证明</a></li></ul></li><li><a href=#有环数据流拓扑的abs>有环数据流拓扑的ABS</a><ul><li><a href=#简要证明-1>简要证明</a></li></ul></li></ul></li><li><a href=#故障恢复>故障恢复</a></li><li><a href=#实现>实现</a></li><li><a href=#性能评估>性能评估</a><ul><li><a href=#实验设置>实验设置</a></li><li><a href=#结论>结论</a></li></ul></li><li><a href=#未来的作和结论>未来的⼯作和结论</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div><dialog id=toc-dialog class="tw-max-w-full tw-w-full tw-max-h-full tw-h-full tw-ml-16"><div class="toc tw-mx-4 tw-max-w-full"><h2 class="tw-mx-0 tw-my-6 tw-uppercase tw-text-2xl">目录</h2><div class=toc-content><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#介绍>介绍</a></li><li><a href=#相关工作>相关工作</a></li><li><a href=#背景-apache-flink-系统>背景: Apache Flink 系统</a><ul><li><a href=#流处理模型>流处理模型</a></li><li><a href=#分布式数据流执行>分布式数据流执行</a></li></ul></li><li><a href=#异步屏障快照abs>异步屏障快照(ABS)</a><ul><li><a href=#问题定义>问题定义</a></li><li><a href=#无环数据流拓扑的abs>无环数据流拓扑的ABS</a><ul><li><a href=#简要证明>简要证明</a></li></ul></li><li><a href=#有环数据流拓扑的abs>有环数据流拓扑的ABS</a><ul><li><a href=#简要证明-1>简要证明</a></li></ul></li></ul></li><li><a href=#故障恢复>故障恢复</a></li><li><a href=#实现>实现</a></li><li><a href=#性能评估>性能评估</a><ul><li><a href=#实验设置>实验设置</a></li><li><a href=#结论>结论</a></li></ul></li><li><a href=#未来的作和结论>未来的⼯作和结论</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div></dialog><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class=single-title data-pagefind-meta=date:2022-07-20 data-pagefind-body>Lightweight Asynchronous Snapshots for Distributed Dataflows</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><span class=screen-reader-text></span><a href=http://www.victorchu.info/authors/victorchutian/>victorchutian</a></span>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/paper/><svg class="icon" viewBox="0 0 512 512"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Paper</a></span></div><div class=post-meta-line><svg class="icon" viewBox="0 0 448 512"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;<time datetime=2022-07-20>2022-07-20</time>&nbsp;<svg class="icon" viewBox="0 0 576 512"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>&nbsp;<time datetime=2026-02-28>2026-02-28</time>&nbsp;<svg class="icon" viewBox="0 0 512 512"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;约 7861 字&nbsp;
<svg class="icon" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;预计阅读 35 分钟&nbsp;</div></div><div class=featured-image><img loading=eager src=/feature-images/paper.webp height=338 width=600></div><div class="details toc print:!tw-block" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span class=details-icon><svg class="icon" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9.0l-22.6-22.6c-9.4-9.4-9.4-24.6.0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6.0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9.0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#介绍>介绍</a></li><li><a href=#相关工作>相关工作</a></li><li><a href=#背景-apache-flink-系统>背景: Apache Flink 系统</a><ul><li><a href=#流处理模型>流处理模型</a></li><li><a href=#分布式数据流执行>分布式数据流执行</a></li></ul></li><li><a href=#异步屏障快照abs>异步屏障快照(ABS)</a><ul><li><a href=#问题定义>问题定义</a></li><li><a href=#无环数据流拓扑的abs>无环数据流拓扑的ABS</a><ul><li><a href=#简要证明>简要证明</a></li></ul></li><li><a href=#有环数据流拓扑的abs>有环数据流拓扑的ABS</a><ul><li><a href=#简要证明-1>简要证明</a></li></ul></li></ul></li><li><a href=#故障恢复>故障恢复</a></li><li><a href=#实现>实现</a></li><li><a href=#性能评估>性能评估</a><ul><li><a href=#实验设置>实验设置</a></li><li><a href=#结论>结论</a></li></ul></li><li><a href=#未来的作和结论>未来的⼯作和结论</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div><div class=content id=content data-pagefind-body><p>本篇是论文<a href=https://arxiv.org/abs/1506.08603 target=_blank rel="noopener noreferrer">Lightweight Asynchronous Snapshots for Distributed Dataflows</a>的中文简单翻译</p><h2 id=概述 class=headerLink><a href=#%e6%a6%82%e8%bf%b0 class=header-mark></a>概述</h2><p>分布式有状态的流处理允许在云上部署和执行大规模的流数据计算，并且要求低延迟和高吞吐。这种模式一个比较大的挑战，就是其容错能力，能够应对潜在的 failure。现有的方案都是依赖周期性地全局状态的快照做失败恢复。 这些方法有两个主要的缺点:</p><ol><li>通常会停止分布式计算，影响流的摄入(为了获得全局的一致性状态，需要停止流处理程序，直到快照的完成)。</li><li>快照的内容包含传输过程中所有的内容，这导致快照的大小过大。</li></ol><p>本篇论文中提出了一个适用于现代数据流执行引擎，并最大限度减少空间需求的轻量级算法 Asynchronous Barrier Snapshot（ABS）。ABS在无环的拓扑结构中只对有状态的operator进行快照，对于有环的执行拓扑只保存最小化的record日志。在Apache Flink（一个支持有状态的分布式流处理分析引擎）中实现了ABS。通过评估表明，这种算法对程序执行没有很重的影响，并且保持了线性的可扩展性，在频繁的快照情况下也表现良好。</p><p><strong>关键词</strong>: 容错，分布式计算，流处理，数据流，云计算，状态管理</p><h2 id=介绍 class=headerLink><a href=#%e4%bb%8b%e7%bb%8d class=header-mark></a>介绍</h2><p>分布式数据流处理是⼀种数据密集计算的新兴方式，它允许基于大量数据的持续计算，致力于在保证高吞吐时，实现端到端的低延迟。有一些时间敏感的框架系统，例如Apache Flink <a href=#refer-anchor-1 rel><sup>1</sup></a> 和 Naiad <a href=#refer-anchor-11 rel><sup>11</sup></a> 受益于数据流处理架构，特别是在实时处理领域(例如，预测分析和复杂事件处理)。容错在这类系统中是最重要的，因为在⼤多数现实世界的⽤例中⽆法承受故障。目前已知的，在有状态系统中实现精准一次语义的方法依赖于全局的，一致性的状态快照。然而，有两个主要的缺点，使得这类应用在实时流处理场景效率低下。</p><ol><li>同步快照技术，会停止整个分布式计算，以获得整个状态的一致性视图。</li><li>此外，据我们所知，目前所有的分布式快照算法都会把未处理和正在传输过程中的事件作为执行图的快照的一部分持久化，通常这会导致快照比实际更大。</li></ol><p>本文中，我们专注于提供轻量级快照，专门针对有状态的分布式实时流系统，对性能影响极小。我们的解决方案提供了异步状态快照，低空间成本，仅包含有向无环图中算子的状态。此外，我们还涵盖了有环的执行情况，且保持快照最小。我们的技术不会停止流的执行，且只会引入少量的运行时开销。本文内容概括如下:</p><ol><li>我们提出并实现了⼀种异步快照算法，可以在有向无环图上实现最小快照。</li><li>我们描述并实现了适⽤于有环图的算法</li><li>我们展⽰了我们⽅法的优势，使用Apache Flink Streaming 作为最先进的技术，用于比较。</li></ol><p>本文其余部分组织如下:</p><ol><li>第二节概述了现有的有状态数据流系统中的分布式全局快照的⽅法。</li><li>第三节提供了Apache Flink 实时流处理的概述和执行模型。</li><li>第四节描述对全局快照的主要⽅法细节。</li><li>在第五节中对恢复⽅案进行了简要描述</li><li>第六节总结了我们的实现，</li><li>在第7节是我们的评估</li><li>第八节中的未来⼯作和结论。</li></ol><h2 id=相关工作 class=headerLink><a href=#%e7%9b%b8%e5%85%b3%e5%b7%a5%e4%bd%9c class=header-mark></a>相关工作</h2><p>在过去的十年中，出现了很多种关于连续处理系统的恢复机制的解决办法<a href=#refer-anchor-4 rel><sup>4</sup></a><sup>,</sup><a href=#refer-anchor-11 rel><sup>11</sup></a>。有一些系统如 Discretized Streams<a href=#refer-anchor-15 rel><sup>15</sup></a>和 Comet<a href=#refer-anchor-6 rel><sup>6</sup></a> 会把连续处理当作无状态的分布式批处理计算，通过重新计算来做状态恢复。另一方面，有状态的数据流系统，例如，Naiad<a href=#refer-anchor-11 rel><sup>11</sup></a>,SDGS<a href=#refer-anchor-5 rel><sup>5</sup></a>,Piccolo<a href=#refer-anchor-12 rel><sup>12</sup></a>和SEEP<a href=#refer-anchor-3 rel><sup>3</sup></a>,是本文中我们主要关注的，它们使用checkpoint来获取全局一致的快照用于失败恢复。</p><p>分布式环境的一致性全局快照问题，自从在 Chandy 和 Lamport 的论文<a href=#refer-anchor-4 rel><sup>4</sup></a>中提出来后，过去二十多年一直在被广泛地研究<a href=#refer-anchor-7 rel><sup>7</sup></a><sup>,</sup><a href=#refer-anchor-8 rel><sup>8</sup></a>。一个全局快照，理论上反映了作业执行的总体状态以及operator实例的可能状态。对于全局一致性快照算法，Naiad<a href=#refer-anchor-11 rel><sup>11</sup></a>中提出了一个简单但代价非常高昂的实现方案：</p><ol><li>首先停止整个执行图的计算</li><li>然后执行快照</li><li>最后，如果快照完成了，每个task再恢复之前的计算</li></ol><p>这个实现方案对吞吐和空间占用都有很大的影响，因为需要停止整个计算，且还依赖上游生产者的事件备份能力。另一个实现方案，就是 Chandy-Lamport 算法<a href=#refer-anchor-4 rel><sup>4</sup></a>,当前它已经应用在很多的系统<a href=#refer-anchor-5 rel><sup>5</sup></a><sup>,</sup><a href=#refer-anchor-10 rel><sup>10</sup></a>中，它是异步地执行快照，并且要求上游数据源可以回溯。它是通过在数据流中发送 marker 来触发算子和通道的状态。但这种算法还需要额外的存储空间用于上游数据量恢复，且备份事件的重新计算也会导致恢复时间较长。我们的方法扩展了Chandy和Lamport最初的异步快照思想，对于无环拓扑图 它不会备份未处理及通道中正在传输的record，对于有环的拓扑图，也只需要很少量的record备份。</p><h2 id=背景-apache-flink-系统 class=headerLink><a href=#%e8%83%8c%e6%99%af-apache-flink-%e7%b3%bb%e7%bb%9f class=header-mark></a>背景: Apache Flink 系统</h2><p>我们所做的工作是以Apache Flink Streaming的容错需求为导向的，Apache Flink Streaming是一个分布式流分析系统，是Apache Flink 技术栈的一部分(以前是stratosphere<a href=#refer-anchor-2 rel><sup>2</sup></a>)。Apache Flink 围绕通用运行时引擎架构，统一处理批处理和流式作业，这些作业由有状态的相互关联的任务组成。Flink中的分析任务会被编译成基于task的有向图。数据从外部源获取，以管道的方式通过有向图在Task间传输。Task根据收到的输入，持续操作自身内部状态，并生成新的输出。</p><h3 id=流处理模型 class=headerLink><a href=#%e6%b5%81%e5%a4%84%e7%90%86%e6%a8%a1%e5%9e%8b class=header-mark></a>流处理模型</h3><p>Apache Flink的流处理API允许复杂流分析作业的组合，这个能力是通过将无界分区数据流(部分排序的记录序列)暴露为其核心数据抽象-<code>DataStreams</code>(数据流)。DataStreams可以由外部数据源产生(例如消息队列，socket流和自定义生成器等)，也可以通过其他的DataStreams转换而来。DataStreams以高阶函数的形式支持多种算子，例如map,filter,reduce等，这些算子被每条记录按序应用同时生成新的DataStreams。每个算子支持并行执行，通过将算子的并行实例运行在相应流的不同分区上，从而允许分布式执行流的转换。</p><p>下面的示例是在Apache Flink 上实现一个简单的增量wordCount程序。在这个程序里，单词从文本文件中读取,每个单词当前出现的次数会被打印到标准输出。这是一个有状态的流处理程序,因为数据源需要感知到文件当前的偏移量，计数器需要维护每个单词当前出现的次数作为它们的内部状态。</p><div class="code-block highlight is-open show-line-numbers tw-group tw-my-2"><div class="tw-flex
tw-flex-row
tw-flex-1
tw-justify-between
tw-w-full tw-bg-bgColor-secondary"><button class="code-block-button
tw-mx-2
tw-flex
tw-flex-row
tw-flex-1" aria-hidden=true><div class="group-[.is-open]:tw-rotate-90 tw-transition-[transform] tw-duration-500 tw-ease-in-out print:!tw-hidden tw-w-min tw-h-min tw-my-1 tw-mx-1"><svg class="icon" viewBox="0 0 320 512"><path d="M285.476 272.971 91.132 467.314c-9.373 9.373-24.569 9.373-33.941.0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941.0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></div><p class="tw-select-none !tw-my-1">scala</p></button><div class=tw-flex><button class="line-number-button
tw-mx-2
tw-hidden
group-[.is-open]:tw-block
group-[.show-line-numbers]:tw-text-fgColor-link
print:!tw-hidden" title="Toggle line numbers"><svg class="icon" viewBox="0 0 512 512"><path d="M61.77 401l17.5-20.15a19.92 19.92.0 005.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 00-8 8v16a8 8 0 008 8h22.83a157.41 157.41.0 00-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33.0 15.94 2.44 15.94 9.09.0 4.72-4.2 8.22-14.36 8.22a41.54 41.54.0 01-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16.0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zM16 160h64a8 8 0 008-8v-16a8 8 0 00-8-8H64V40a8 8 0 00-8-8H32a8 8 0 00-7.14 4.42l-8 16A8 8 0 0024 64h8v64H16a8 8 0 00-8 8v16a8 8 0 008 8zm-3.91 160H80a8 8 0 008-8v-16a8 8 0 00-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44.0-29.06-25-39.56-44.47-39.56-21.36.0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44.0 019.46-3.84c3.33.0 9.28 1.56 9.28 8.75C51 248.19.0 257.31.0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>
<button class="wrap-code-button
tw-select-none
tw-mx-2
tw-hidden
group-[.is-open]:tw-block
group-[.is-wrap]:tw-text-fgColor-link
print:!tw-hidden" title="Toggle code wrap"><svg class="icon" viewBox="0 0 448 512"><path d="M16 132h416c8.837.0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163.0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
<button class="copy-code-button
tw-select-none
tw-mx-2
tw-hidden
group-[.is-open]:tw-block
hover:tw-text-fgColor-link
print:!tw-hidden" title="Copy code">
<span class="copy-icon tw-block"><svg class="icon" viewBox="0 0 448 512"><path d="M433.941 65.941l-51.882-51.882A48 48 0 00348.118.0H176c-26.51.0-48 21.49-48 48v48H48c-26.51.0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51.0 48-21.49 48-48v-48h80c26.51.0 48-21.49 48-48V99.882a48 48 0 00-14.059-33.941zM266 464H54a6 6 0 01-6-6V150a6 6 0 016-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 01-6 6zm128-96H182a6 6 0 01-6-6V54a6 6 0 016-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 01-6 6zm6-256h-64V48h9.632c1.591.0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 011.757 4.243V112z"/></svg></span>
<span class="check-icon tw-hidden"><svg class="icon" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206.0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204.0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204.0l36.203 36.204c9.997 9.997 9.997 26.206.0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
</button>
<button class="tw-select-none
tw-mx-2
tw-block
group-[.is-open]:tw-hidden
print:!tw-hidden" disabled aria-hidden=true><svg class="icon" viewBox="0 0 512 512"><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8.0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8.0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button></div></div><pre style=counter-reset:codeblock class="tw-block tw-m-0 tw-p-0"><code id=codeblock-id-1 class="chroma
!tw-block
tw-p-0
tw-m-0
tw-transition-[max-height]
tw-duration-500
tw-ease-in-out
group-[.is-closed]:!tw-max-h-0
group-[.is-wrap]:tw-text-wrap
tw-overflow-y-hidden
tw-overflow-x-auto
tw-scrollbar-thin"><span class=line><span class=cl><span class=k>var</span> <span class=n>env</span><span class=k>:</span> <span class=kt>StreamExecutionEnvironment</span> <span class=o>=</span> <span class=k>_</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>.</span><span class=n>setParallelism</span><span class=o>(</span><span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=n>wordStream</span> <span class=k>=</span> <span class=n>env</span><span class=o>.</span><span class=n>readTextFile</span><span class=o>(</span><span class=n>path</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=k>val</span> <span class=n>countStream</span> <span class=k>=</span> <span class=n>wordStream</span><span class=o>.</span><span class=n>groupBy</span><span class=o>(</span><span class=k>_</span><span class=o>).</span><span class=n>count</span>
</span></span><span class=line><span class=cl><span class=n>countStream</span><span class=o>.</span><span class=n>print</span></span></span></code></pre></div><h3 id=分布式数据流执行 class=headerLink><a href=#%e5%88%86%e5%b8%83%e5%bc%8f%e6%95%b0%e6%8d%ae%e6%b5%81%e6%89%a7%e8%a1%8c class=header-mark></a>分布式数据流执行</h3><p>当用户执行应用程序的时候，所有的DataStream 算子被编译成一个有向图<code>G=(T,E)</code>，类似于Naiad<a href=#refer-anchor-11 rel><sup>11</sup></a>。其中顶点T代表任务，边E代表任务间的数据管道。图-就是一个增量wordCount的执行图。正如所示，每个算子的实例都被封装在相应的任务中。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/word_count.webp alt=图- height=205 width=426></p><p>task可以被进一步分类，没有输入的可以看做是Source，没有输出的可以看作为Sink。更进一步，M代表了task并行执行阶段所有传输的记录，每一个task, $t \in T$ 封装了独立执行的operator实例。由以下部分组成:</p><ul><li>输入输出管道的集合: $I_{t},O_{t} \subset E$;</li><li>操作符状态: $s_{t}$;</li><li>用户定义函数: $f_{t}$;</li></ul><p>数据的摄取是基于拉取: 在task的执行期间，每个task消费输入记录，更新自己的算子状态并更加用户定义函数生成新的记录。更具体地说，一个task, $t \in T$ 每接收的每一条数据 $r \in M$，会产生新的输出集合 $D \in M$ 和 新的状态 $s&rsquo;_{t}$。上述过程是根据UDF生成的:</p><p>$$
f_{t}: s_{t},r \to \lbrack s&rsquo;_{t},D \rbrack
$$</p><h2 id=异步屏障快照abs class=headerLink><a href=#%e5%bc%82%e6%ad%a5%e5%b1%8f%e9%9a%9c%e5%bf%ab%e7%85%a7abs class=header-mark></a>异步屏障快照(ABS)</h2><p>为了提供一致性的结果，分布式处理系统要能容忍任务失败(从错误中恢复)，一种提供容错性的方法是周期性的获取执行图的快照，用于后面从故障中恢复。快照是执行图的全局状态，要求具备从当前状态重启计算的所有必需信息。</p><h3 id=问题定义 class=headerLink><a href=#%e9%97%ae%e9%a2%98%e5%ae%9a%e4%b9%89 class=header-mark></a>问题定义</h3><p>我们定义执行图 $G=(T,E)$ 的全局快照为 $G^{<em>}=(T^{</em>},E^{<em>})$，它是一个集合包含所有task和edge的状态。更进一步，$T^{</em>}$ 包含了所有算子的状态 $s^{<em>}_{t} \in T^{</em>} ,\forall t \in T$ ，$E^{<em>}$ 是通道状态的集合 $e^{</em>} \in E^{<em>}$, $e^{</em>}$ 由e中传输的记录组成。</p><p>我们要求每个快照G保持某些属性，以保证恢复后的正确结果。例如Tel<a href=#refer-anchor-14 rel><sup>14</sup></a>中所述的最终性(termination)与可行性(feasibility)。</p><p>最终性(termination)保证了一个快照算法在所有处理流程都处于活动状态的情况下，在其启动后的有限时间内最终完成。可行性(feasibility)表示一个快照的意义，即在快照过程中没有丢失有关计算的信息。形式上，这意味着在快照中维护因果顺序<a href=#refer-anchor-9 rel><sup>9</sup></a>，以便任务中传递的记录也从快照的⻆度发送。</p><h3 id=无环数据流拓扑的abs class=headerLink><a href=#%e6%97%a0%e7%8e%af%e6%95%b0%e6%8d%ae%e6%b5%81%e6%8b%93%e6%89%91%e7%9a%84abs class=header-mark></a>无环数据流拓扑的ABS</h3><p>当执行被划分为多个阶段(Stages)时，在不持久化通道状态(channel state)的情况下执行快照是可行的。Stages将注入的数据流和所有相关的计算划分为一系列可能的执行。其中所有先前的输入和生成的输出都已完全处理完毕。一个stage结束时的operator状态的集合反映了整个执行的历史。因此，它可以单独用于快照。我们算法的核心思想是<strong>在保持连续数据摄取的同时，使用分段快照创建相同的快照</strong>。</p><p>我们的⽅法是在连续的数据流执⾏中模拟出了阶段。这是通过在执行图的源中周期性注入特殊的屏障(barrier)标记来实现的，这些特殊的barrier标记会随着整个DAG图被推送到下游，最终到sink端。随着每个任务收到暗示执⾏阶段开始的屏障(barrier)事件，全局快照被增量的构建。我们进一步的对算法作出如下假设:</p><ul><li>网络通道是相对可靠的，遵循FIFO先进先出的顺序，且可以是阻塞和非阻塞。当通道被阻塞时，所有消息都被缓存到buffer。直到通道不阻塞后，消息才开始分发。</li><li>任务可以触发对其通道组件的操作，例如阻塞、解除阻塞和发送消息。对于一个task的所有输出管道，还支持广播操作。</li><li>源任务注⼊的消息(例如阶段屏障）被解析为"Nil"输⼊通道。</li></ul><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/algorithm_1.webp height=512 width=338></p><p>ABS算法一执行过程如下:</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/acycle_graph.webp alt=图二 height=350 width=1598></p><ul><li>中心协调器周期性的向所有的source注入阶段性的屏障(stage barriers)。当source收到一个barrier时，它会做当前状态的一个快照。然后将这个barrier广播到它的全部输出(图二中a)。</li><li>当一个非source的task从它的一个输入端收到barrier时，它会阻塞这个输入通道直到它从所有输入端收到barrier为止(图中b，算法第9行)。</li><li>当收齐所有的barrier后，该task就会生成其当前状态的快照并广播barrier给所有output(图中c，算法第12-13行)。</li><li>然后，这个task会unblock它的所有输入通道继续计算(图中d，算法15行)。</li></ul><p>最终的全局快照 $G^{<em>} = (T^{</em>},E^{<em>})$ 是所有 $E^{</em>}=\emptyset$ 的operator的状态 $T^*$ 组成的。</p><h4 id=简要证明 class=headerLink><a href=#%e7%ae%80%e8%a6%81%e8%af%81%e6%98%8e class=header-mark></a>简要证明</h4><p>如前所述，快照算法应保证最终性和可⾏性。最终性由通道和无环执行图属性保证。通道的可靠性保证只要task存活最终会收到之前的每一个barrier，DAG图中的每一个task都会从它所有的输入通道收到barrier并生成快照。</p><p>在可行性方面，全局快照中operator的状态只反映到最后一个stage处理的数据的历史。由管道的FIFO(先进先出)顺序属性和barrier事件到来时的队列阻塞保证。这确保了快照生成前没有post-shot记录(跟在barrier后的记录)被处理。</p><h3 id=有环数据流拓扑的abs class=headerLink><a href=#%e6%9c%89%e7%8e%af%e6%95%b0%e6%8d%ae%e6%b5%81%e6%8b%93%e6%89%91%e7%9a%84abs class=header-mark></a>有环数据流拓扑的ABS</h3><p>在执行图存在环的情况下，上面的ABS算法不会停止，会导致死锁，因为task会无限等待来自所有输入的barrier。此外，环中任意传输的records将不包含在快照中，违反了可行性,数据准确性有误。因此，为了可行性需要一致地将一个周期内生成的所有记录包括在快照中，并在恢复时将这些记录放回传输。处理有环图的方法(如下图算法二)扩展了基本算法，并且没有引入额外的通道阻塞。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/algorithm_2.webp height=670 width=345></p><p>首先通过静态分析在执行图的循环中定义一个back-edges集合 L，根据控制流图理论，一个有向图中，一个back-edge是一个指向已经在深度优先搜索中被访问的点(vertex)和边(edge)。定义执行图G(T,E\L)是一个包含拓扑中所有task的有向无环图(DAG)。从这个 DAG 的⻆度来看，算法像以前⼀样运⾏，但是，我们还在快照期间对从已识别的back-edges接收到的记录进⾏下游备份。对于 $L_{t} \subset I_{t}$ ,$L_t$ 的每个消费者任务 t 实现了上述逻辑，从 $L_{t}$ 转发barrier的那⼀刻起，直到从 $L_{t}$ 接收到它们,它创建从 $L_t$ 接收到的所有记录的⽇志备份。屏障将循环传输中的所有记录推送到下游⽇志中，因此它们在⼀致快照中包含⼀次。</p><p>算法二的执行过程如下图所示:</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/cycle_graph.webp height=710 width=3890></p><ul><li>有back-edge作为输入通道的task，当它们的普通(regular)输入通道(e∉L)都接受到了barrier，该task会生成一个本地的备份(图中b，算法14行)。</li><li>从这个时间点开始，这个节点将从back-edges收到的所有record记录下来，直到收到来自相应的barrier(算法26行)。</li><li>如图中c，所有循环中的pre-shot records和状态的备份都被作为快照的一部分。意味着最终的全局状态 $G^{<em>} = (T^{</em>},L^{<em>})$ 包含所有task状态和仅在传输中的back-edge records $L^{</em>} \subset E^{*}$</li></ul><h4 id=简要证明-1 class=headerLink><a href=#%e7%ae%80%e8%a6%81%e8%af%81%e6%98%8e-1 class=header-mark></a>简要证明</h4><p>现在我们需要在这个版本的算法中再次证明最终性和可行性。</p><p>最终性(termination)与无环图一样，因为每个task最终接收所有输入通道(包含back-end通道)的barrier，并且完成快照。一旦接收到了所有常规输入的barrier,就广播它，从而避免了前面提到的死锁。</p><p>FIFO的顺序属性仍然适用于back-edges,以下属性证明了可行性(feasibility)</p><ul><li>快照中包含的每个task的状态，是在处理regular输入接收的post-shot record之前执行的task状态副本。- 快照中包含的下游日志是完整的，由于FIFO保证，包含back-edge接收的所有barrier之前的所有pending的post-shot record。</li></ul><h2 id=故障恢复 class=headerLink><a href=#%e6%95%85%e9%9a%9c%e6%81%a2%e5%a4%8d class=header-mark></a>故障恢复</h2><p>虽然不是这项⼯作的主要焦点，但⼯作故障恢复⽅案激发了我们快照⽅法的应⽤。因此，我们在此提供有关其操作的简要说明。有⼏种使⽤⼀致快照的故障恢复⽅案。</p><p>最简单的形式是，可以从最后一个全局快照重新启动整个执行图。例如每个task t:</p><ul><li>从持久化存储中获取快照st的状态并设置为初始状态.</li><li>恢复其备份日志并处理其中包含的所有records。</li><li>开始摄取数据从输入通道。</li></ul><p>部分图恢复方案也是可行的，通过仅重新调度上游依赖task。以及它们各自的上游task，直到source。一个恢复计划的例子如图所示。为了提供exactly-once语义。重复的记录应该被忽略在下游节点，避免重复计算。可以按SDG类似的方案。使用来自source的序列号标记记录，每个下游节点可以丢弃序列号小于已处理数据的记录。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/recovery.webp height=193 width=507></p><h2 id=实现 class=headerLink><a href=#%e5%ae%9e%e7%8e%b0 class=header-mark></a>实现</h2><p>我们将 ABS 算法的实现贡献给 Apache Flink，以便提供精准⼀次的流式运⾏时的处理语义。在我们的当前实现中，阻塞的通道将所有即将到来的记录存储在磁盘上，⽽不是将它们保存在内存中以增加可扩展性。虽然这种技术确保了健壮性，但是，它增加了运⾏时对ABS的影响。</p><p>为了区分算⼦状态和数据，我们引⼊了⼀个显式的 OperatorState 接⼝，该接⼝包含状态的更新和状态的检查点的相关⽅法。我们为Apache Flink⽀持的有状态运⾏时算子(例如，基于偏移的数据源或聚合)提供了OperatorState 实现。</p><p>快照协调被实现为⼀个作业管理器上的actor进程，用于保持单个作业的执⾏图的全局状态。协调器定期向执行图的所有数据源注入stage barriers(阶段屏障事件)。除非重新配置，最后⼀个全局快照状态在算子们中从分布式内存持久存储中恢复。</p><h2 id=性能评估 class=headerLink><a href=#%e6%80%a7%e8%83%bd%e8%af%84%e4%bc%b0 class=header-mark></a>性能评估</h2><p>我们评估的目标是将ABS的运行时开销与Naiad<a href=#refer-anchor-11 rel><sup>11</sup></a>中采用的全局同步快照算法比较，并测试算法在大量节点上的扩展性。</p><h3 id=实验设置 class=headerLink><a href=#%e5%ae%9e%e9%aa%8c%e8%ae%be%e7%bd%ae class=header-mark></a>实验设置</h3><p>⽤于评估的执⾏拓扑由6个不同的运算符组成(如下图)。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/benchmark_dag.webp height=338 width=474></p><p>并⾏度与集群节点数相同，task点的数量是6倍集群节点数量。这个执行有三个shuffle，这样可以尽量增大channel block的影响。Source会生成10亿条数据，均匀分布在Source实例中，拓扑图中operator的状态是key的聚合的中间结果和source的offsets，这个测试跑在Amazon EC2集群，使用40个m3.medium instances。</p><p>我们测试了不同方案的快照运行时开销，ABS与同步方式快照。在Apache Flink上实现了Naiad中采用的同步快照算法，为了让这个比较有相同的执行后端。这个实验跑在10节点集群上。为了评估算法的可扩展性 我们处理固定数量的数据。同时将并行度从5个增加到40个。</p><h3 id=结论 class=headerLink><a href=#%e7%bb%93%e8%ae%ba class=header-mark></a>结论</h3><p>图中我们展示了两种算法对基线的运行时影响，当快照的时间间隔很短，同步快照的性能影响很明显，因为程序花费更多时间没有处理数据，为了获得全局快照。ABS对运行时的影响要小很多。因为它不会阻塞整个执行过程的持续运行。并且保持相当稳定的吞吐率，对于较大的快照间隔，同步算法的影响较小，同时让系统在剩余的执行期间以正常的吞吐量运行。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/fig6.webp height=307 width=486></p><p>然而对于延迟很敏感的应用来说，突发的快照会影响SLA，例如入侵检测，因此这些应用将进一步受益于ABS的性能提升。下图中我们将运行ABS的拓扑的可扩展性(并行度从5增加到40)与基线的3秒快照间隔进行了比较，很明显，基线和ABS都实现了线性可扩展性。</p><p><img class=tw-inline loading=lazy src=/posts/2022/07/53540652/fig7.webp height=329 width=500></p><h2 id=未来的作和结论 class=headerLink><a href=#%e6%9c%aa%e6%9d%a5%e7%9a%84%e4%bd%9c%e5%92%8c%e7%bb%93%e8%ae%ba class=header-mark></a>未来的⼯作和结论</h2><p>在未来的⼯作中，我们计划通过解耦快照状态和操作状态来探索进⼀步降低 ABS 影响的可能性。那将允许纯粹的异步状态管理，任务可以在持久化快照的同时持续处理记录。在这样的⽅案中，还需要同步快照前和快照后的记录，相应的状态可以通过标记记录它们所属的快照来解决。这种⽅法将增加计算空间和算法的⽹络 I/O 要求，我们计划将其性能与我们当前的ABS实现进⾏⽐较。最后，我们计划研究不同的恢复技术，这些技术可以保持精确⼀次的语义，同时通过以下⽅式最⼤限度地减少在每个任务的粒度上重新配置的需要。</p><p>综上所述，我们关注的是在分布式数据流系统上执行周期性全局快照的问题，我们介绍了一种新的快照技术ABS，有很好的吞吐量。ABS是第一个考虑无环的执行拓扑可能的最小化状态的算法。此外，通过只存储需要在恢复时重新处理的记录，我们扩展了ABS来处理有环执行拓扑图。我们在Apache Flink上实现了ABS算法，并和同步快照作了对比，测试了我们的方法。ABS显示出良好的效果，对整体执行吞吐量的影响很小，具有线性可扩展性。</p><h2 id=参考 class=headerLink><a href=#%e5%8f%82%e8%80%83 class=header-mark></a>参考</h2><div id=refer-anchor-1></div><ul><li>[1] <a href=https://flink.apache.org/ target=_blank rel="noopener noreferrer">Apache flink</a></li></ul><div id=refer-anchor-2></div><ul><li>[2] A. Alexandrov, R. Bergmann, S. Ewen, J.-C. Freytag, F. Hueske, A. Heise, O. Kao, M. Leich, U. Leser,V. Markl, et al. The stratosphere platform for big data analytics. The VLDB JournalThe International Journal on Very Large Data Bases, 23(6):939–964, 2014.</li></ul><div id=refer-anchor-3></div><ul><li>[3] R. Castro Fernandez, M. Migliavacca, E. Kalyvianaki, and P. Pietzuch. Integrating scale out and fault tolerance in stream processing using operator state management. In Proceedings of the 2013 ACM SIGMOD international conference on Management of data, pages
725–736. ACM, 2013.</li></ul><div id=refer-anchor-4></div><ul><li>[4] K. M. Chandy and L. Lamport. Distributed snapshots: determining global states of distributed systems. ACM Transactions on Computer Systems (TOCS), 3(1):63– 75, 1985.</li></ul><div id=refer-anchor-5></div><ul><li>[5] R. C. Fernandez, M. Migliavacca, E. Kalyvianaki, and P. Pietzuch. Making state explicit for imperative big data processing. In USENIX ATC, 2014.</li></ul><div id=refer-anchor-6></div><ul><li>[6] B. He, M. Yang, Z. Guo, R. Chen, B. Su, W. Lin, and L. Zhou. Comet: batched stream processing for data intensive distributed computing. In Proceedings of the 1st ACM symposium on Cloud computing, pages 63–74.
ACM, 2010.</li></ul><div id=refer-anchor-7></div><ul><li>[7] A. D. Kshemkalyani, M. Raynal, and M. Singhal. An introduction to snapshot algorithms in distributed computing. Distributed systems engineering, 2(4):224,1995.</li></ul><div id=refer-anchor-8></div><ul><li>[8] T. H. Lai and T. H. Yang. On distributed snapshots. Information Processing Letters, 25(3):153–158, 1987.</li></ul><div id=refer-anchor-9></div><ul><li>[9] L. Lamport. Time, clocks, and the ordering of events in a distributed system. Communications of the ACM, 21(7):558–565, 1978.</li></ul><div id=refer-anchor-10></div><ul><li>[10] Y. Low, D. Bickson, J. Gonzalez, C. Guestrin, A. Kyrola, and J. M. Hellerstein. Distributed graphlab: a framework for machine learning and data mining in the cloud. Proceedings of the VLDB Endowment, 5(8):716–727, 2012.</li></ul><div id=refer-anchor-11></div><ul><li>[11] D. G. Murray, F. McSherry, R. Isaacs, M. Isard, P. Barham, and M. Abadi. Naiad: a timely dataflow system. In Proceedings of the Twenty-Fourth ACM Symposium on Operating Systems Principles, pages 439–455. ACM, 2013.</li></ul><div id=refer-anchor-12></div><ul><li>[12] R. Power and J. Li. Piccolo: Building fast, distributed programs with partitioned tables. In OSDI, volume 10, pages 1–14, 2010.</li></ul><div id=refer-anchor-13></div><ul><li>[13] Z. Qian, Y. He, C. Su, Z. Wu, H. Zhu, T. Zhang, L. Zhou, Y. Yu, and Z. Zhang. Timestream: Reliable stream computation in the cloud. In Proceedings of the 8th ACM European Conference on Computer Systems, pages 1–14. ACM, 2013.</li></ul><div id=refer-anchor-14></div><ul><li>[14] G. Tel. Introduction to distributed algorithms. Cambridge university press, 2000.</li></ul><div id=refer-anchor-15></div><ul><li>[15] M. Zaharia, T. Das, H. Li, S. Shenker, and I. Stoica. Discretized streams: an efficient and fault-tolerant model for stream processing on large clusters. In Proceedings of the 4th USENIX conference on Hot Topics in Cloud Ccomputing, pages 10–10. USENIX Association, 2012.</li></ul></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><div class=related-image><a href=/posts/2022/06/7d35c7f1/><img src=/feature-images/paper.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/2022/06/7d35c7f1/>Presto: SQL on EveryThing</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/2020/05/f9aa8120/><img src=/feature-images/paper.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/2020/05/f9aa8120/>Apache Flink™: Stream and Batch Processing in a Single Engine</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/2020/05/85a42be3/><img src=/feature-images/paper.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/2020/05/85a42be3/>Dataflow 模型：一种能平衡准确性、延迟、成本的大规模、无限、乱序的数据处理的实践方法</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/2020/05/6fd40c2d/><img src=/feature-images/paper.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/2020/05/6fd40c2d/>MapReduce面向大型集群的简化数据处理</a></h2></div><div class=related-item-container><div class=related-image><a href=/posts/2019/11/3989ef36/><img src=/feature-images/architecture.webp height=200 width=400></a></div><h2 class=related-title><a href=/posts/2019/11/3989ef36/>大型网站技术架构-读书笔记</a></h2></div></div><div class="sponsor print:tw-hidden"><div class=sponsor-avatar></div><p class=sponsor-bio><em>如果你觉得这篇文章对你有所帮助，请我一杯咖啡吧~</em></p><div class=sponsor-custom><div style=display:flex;justify-content:center;gap:30px><div style=text-align:center><img src=/images/weixinpay.webp alt=微信支付 style=width:200px;height:auto;border-radius:8px><span style=display:block;margin-top:10px;font-size:14px;color:#666>微信支付</span></div><div style=text-align:center><img src=/images/alpay.webp alt=支付宝 style=width:200px;height:auto;border-radius:8px><span style=display:block;margin-top:10px;font-size:14px;color:#666>支付宝</span></div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2026-02-28</span></div><div class=post-info-license></div></div><div class="post-info-line print:!tw-hidden"><div class=post-info-md></div><div class=post-info-share><button title="分享到 Instapaper" data-sharer=instapaper data-url=http://www.victorchu.info/posts/2022/07/53540652/ data-title="Lightweight Asynchronous Snapshots for Distributed Dataflows" data-description><svg class="icon" role="img" viewBox="0 0 24 24"><title>Instapaper</title><path d="M14.766 20.259c0 1.819.271 2.089 2.934 2.292V24H6.301v-1.449c2.666-.203 2.934-.473 2.934-2.292V3.708c0-1.784-.27-2.089-2.934-2.292V0h11.398v1.416c-2.662.203-2.934.506-2.934 2.292v16.551z"/></svg></button><button title="分享到 Pocket" data-sharer=pocket data-url=http://www.victorchu.info/posts/2022/07/53540652/><svg class="icon" viewBox="0 0 448 512"><path d="M407.6 64h-367C18.5 64 0 82.5.0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4.0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9.0 30.7 13.8 30.7 30.7.0 17.8-2.9 15.7-114.8 123.2z"/></svg></button><button title="分享到 Flipboard" data-sharer=flipboard data-url=http://www.victorchu.info/posts/2022/07/53540652/ data-title="Lightweight Asynchronous Snapshots for Distributed Dataflows"><svg class="icon" viewBox="0 0 448 512"><path d="M0 32v448h448V32H0zm358.4 179.2h-89.6v89.6h-89.6v89.6H89.6V121.6h268.8v89.6z"/></svg></button><button title="分享到 微博" data-sharer=weibo data-url=http://www.victorchu.info/posts/2022/07/53540652/ data-title="Lightweight Asynchronous Snapshots for Distributed Dataflows" data-image=/feature-images/paper.webp><svg class="icon" viewBox="0 0 512 512"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7.0 395.3.0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></button><button title="分享到 Evernote" data-sharer=evernote data-url=http://www.victorchu.info/posts/2022/07/53540652/ data-title="Lightweight Asynchronous Snapshots for Distributed Dataflows"><svg class="icon" viewBox="0 0 384 512"><path d="M120.82 132.21c1.6 22.31-17.55 21.59-21.61 21.59-68.93.0-73.64-1-83.58 3.34-.56.22-.74.0-.37-.37L123.79 46.45c.38-.37.6-.22.38.37-4.35 9.99-3.35 15.09-3.35 85.39zm79 308c-14.68-37.08 13-76.93 52.52-76.62 17.49.0 22.6 23.21 7.95 31.42-6.19 3.3-24.95 1.74-25.14 19.2-.05 17.09 19.67 25 31.2 24.89A45.64 45.64.0 00312 393.45v-.08c0-11.63-7.79-47.22-47.54-55.34-7.72-1.54-65-6.35-68.35-50.52-3.74 16.93-17.4 63.49-43.11 69.09-8.74 1.94-69.68 7.64-112.92-36.77.0.0-18.57-15.23-28.23-57.95-3.38-15.75-9.28-39.7-11.14-62 0-18 11.14-30.45 25.07-32.2 81 0 90 2.32 101-7.8 9.82-9.24 7.8-15.5 7.8-102.78 1-8.3 7.79-30.81 53.41-24.14 6 .86 31.91 4.18 37.48 30.64l64.26 11.15c20.43 3.71 70.94 7 80.6 57.94 22.66 121.09 8.91 238.46 7.8 238.46C362.15 485.53 267.06 480 267.06 480c-18.95-.23-54.25-9.4-67.27-39.83zm80.94-204.84c-1 1.92-2.2 6 .85 7 14.09 4.93 39.75 6.84 45.88 5.53 3.11-.25 3.05-4.43 2.48-6.65-3.53-21.85-40.83-26.5-49.24-5.92z"/></svg></button></div></div></div><div class=post-info-more><section class=post-tags><svg class="icon" viewBox="0 0 640 512"><path d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"/></svg>&nbsp;<a href=/tags/bigdata/>BigData</a>,&nbsp;<a href=/tags/distributed/>Distributed</a></section><section class=print:!tw-hidden><span><button class="tw-text-fgColor-link-muted hover:tw-text-fgColor-link-muted-hover" onclick=window.history.back()>返回</button></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class="post-nav print:tw-hidden"><a href=/posts/2022/07/78e26fb6/ class=prev rel=prev title=Mysql存储树结构><svg class="icon" viewBox="0 0 256 512"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9.0l22.6 22.6c9.4 9.4 9.4 24.6.0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6.0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9.0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Mysql存储树结构</a>
<a href=/posts/2022/07/231ca7f/ class=next rel=next title="What Every Programmer Should Know Computer 001">What Every Programmer Should Know Computer 001<svg class="icon" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9.0l-22.6-22.6c-9.4-9.4-9.4-24.6.0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6.0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9.0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div></div><div id=comments class="print:!tw-hidden tw-pt-32 tw-pb-8"><div id=giscus></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.155.2">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.4.2"><svg class="icon" viewBox="0 0 576 512"><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1.0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7.0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174 402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7-43.2-43.2c-4.1-4.1-10.8-4.1-14.8.0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a></div><div class=footer-line><svg class="icon" viewBox="0 0 512 512"><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532.0-2e2-89.451-2e2-2e2.0-110.531 89.451-2e2 2e2-2e2 110.532.0 2e2 89.451 2e2 2e2.0 110.532-89.451 2e2-2e2 2e2zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43.0-140.484-61.425-140.484-141.567.0-79.152 60.275-139.401 139.762-139.401 55.531.0 88.738 26.62 97.593 34.779a11.965 11.965.0 011.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303.0-77.916 35.33-77.916 80.082.0 41.589 26.888 83.692 78.277 83.692 32.657.0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947.0 01-1.152 15.518z"/></svg>2016 - 2026<span class=author>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">victorchutian</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href=https://beian.miit.gov.cn/ rel=noopener target=_blank>浙 ICP 备 18037908 号 - 1 </a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><span class=icp><img src=/images/gongan.webp alt style=display:inline-block;vertical-align:middle><a href="https://beian.mps.gov.cn/#/query/webSearch?code=33010902002043" rel=noopener target=_blank>浙公网安备 33010902002043 号</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer><div class="print:!tw-hidden tw-flex tw-flex-col tw-fixed tw-right-4 tw-bottom-4 tw-gap-2"><a href=#back-to-top id=back-to-top-button class="tw-transition-opacity tw-opacity-0 tw-block tw-bg-bgColor-secondary tw-rounded-full" style=padding:.6rem;line-height:1.3rem;font-size:1rem title=回到顶部><svg class="icon" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
</a><button id=toc-drawer-button class="tw-block tw-bg-bgColor-secondary tw-rounded-full md:tw-hidden" style=padding:.6rem;line-height:1.3rem;font-size:1rem>
<svg class="icon" viewBox="0 0 448 512"><path d="M16 132h416c8.837.0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163.0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>
</button><a href=#comments id=view-comments class="tw-block tw-bg-bgColor-secondary tw-rounded-full" style=padding:.6rem;line-height:1.3rem;font-size:1rem title=查看评论>
<svg class="icon" viewBox="0 0 512 512"><path d="M256 32C114.6 32 0 125.1.0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3.0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4.0 256-93.1 256-208S397.4 32 256 32z"/></svg></a></div><link rel=stylesheet href=/lib/katex/katex.min.291db6705f4ae43af07a57a5d4b06e31.css integrity="md5-KR22cF9K5Drwelel1LBuMQ=="><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.727189e34fc67f1c2e7020d67aada5dc.css integrity="md5-cnGJ40/GfxwucCDWeq2l3A=="><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.727189e34fc67f1c2e7020d67aada5dc.css integrity="md5-cnGJ40/GfxwucCDWeq2l3A=="></noscript><script>window.config={"algoliasearch.min.js":"/lib/algoliasearch/algoliasearch-lite.umd.min.js","autocomplete.min.js":"/lib/autocomplete/autocomplete.min.js",comment:{giscus:{darkTheme:"catppuccin_frappe",dataCategory:"Announcements",dataCategoryId:"DIC_kwDORI9uYs4C15sc",dataEmitMetadata:"0",dataInputPosition:"top",dataLang:"zh-CN",dataLoading:"lazy",dataMapping:"pathname",dataReactionsEnabled:"1",dataRepo:"chutian0610/blog-comment",dataRepoId:"R_kgDORI9uYg",dataStrict:"0",lightTheme:"catppuccin_latte"}},data:{"desktop-header-typeit":"Victor's Code Journey","mobile-header-typeit":"Victor's Code Journey"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"X9UOD4FSUP",algoliaIndex:"hugo",algoliaSearchKey:"fa32db1f02073025c69da8ebad0a6aa6",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},sharerjs:!0,typeit:{cursorChar:null,cursorSpeed:null,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:null,speed:null}}</script><script src=/lib/sharer/sharer.min.b834cfb885a9d1d9cc75ca8215372179.js integrity="md5-uDTPuIWp0dnMdcqCFTcheQ=="></script><script src=/lib/typeit/typeit.min.4297640b5eb76c2398632d6ec76a9f01.js integrity="md5-QpdkC163bCOYYy1ux2qfAQ=="></script><script src=/lib/katex/katex.min.15c1bf7dc295f5edacb4dd77f123b603.js integrity="md5-FcG/fcKV9e2stN138SO2Aw==" defer></script><script src=/lib/katex/auto-render.min.deba59a48dbf0bdd912d0d2c8b08c1eb.js integrity="md5-3rpZpI2/C92RLQ0siwjB6w==" defer></script><script src=/lib/katex/copy-tex.min.6be74da2bd31a1975da5090d5926cd54.js integrity="md5-a+dNor0xoZddpQkNWSbNVA==" defer></script><script src=/lib/katex/mhchem.min.902d3a9c2737d9124d1f712d3c0527c9.js integrity="md5-kC06nCc32RJNH3EtPAUnyQ==" defer></script><script src=/js/katex.min.js defer></script><script src=/js/theme.min.js defer></script><script src=/js/giscus.min.js defer></script><script type=speculationrules>
  {
    "prerender": [
      {
        "where": { "href_matches": "/*" },
        "eagerness": "moderate"
      }
    ]
  }
</script></body></html>